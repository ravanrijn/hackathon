
var SpeedStatsCollector=function(W){this.measurements={};this.W=W;this.xsrfToken=$('input[name="nl.marktplaats.xsrf.token"]').val();};_.extend(SpeedStatsCollector.prototype,{init:function(){this.endPointUrl=this.W.endpointUrl;$(this.W).load(_.bind(this.sendMeasurements,this));},generateUserAgent:function(){var ua=(navigator.userAgent).toLowerCase();var device={};if(ua.indexOf('safari')!==-1){device.browser='safari';}else if(ua.indexOf('firefox')!==-1){device.browser='firefox';}else if(ua.indexOf('msie')!==-1){device.browser='msie';}
if(ua.indexOf('chrome')!==-1){device.browser='chrome';}
device.isMobile=this.isTouchDevice();return device;},isTouchDevice:function(){return'ontouchstart'in window;},sendMeasurements:function(){this.measurements.virtualUrl=$('body').data('ga-page-view-url');var generateUserAgent=this.generateUserAgent();this.measurements.userAgentBrowser=generateUserAgent.browser;this.measurements.isMobile=generateUserAgent.isMobile;if(this.W.performance&&this.W.performance.timing){var timing=this.W.performance.timing;setTimeout(_.bind(function(){this.measurements.hasPerformance=true;this.measurements.domStart=timing.domLoading;this.measurements.redirectTime=timing.redirectEnd-timing.redirectStart;this.measurements.connectTime=timing.connectEnd-timing.connectStart;this.measurements.requestTime=timing.responseStart-timing.requestStart;this.measurements.responseTime=timing.responseEnd-timing.responseStart;this.measurements.loadEventTime=timing.loadEventStart-timing.fetchStart;this.measurements.domContentTime=timing.domContentLoadedEventStart-timing.fetchStart;this.measurements.networkLatency=timing.responseEnd-timing.fetchStart;this.measurements.renderTime=timing.loadEventEnd-timing.responseEnd;this.measurements.totalPageLoad=timing.loadEventEnd-timing.navigationStart;this.measurements.domCompleteTime=timing.domComplete-timing.domLoading;this.postMeasurements(this.measurements);},this),1);}else if(this.W.sitespeedBootstrap){this.measurements.hasPerformance=false;this.measurements.domContentTime=new Date().getTime()-this.W.sitespeedBootstrap.loadStartTime;this.measurements.domStart=this.W.sitespeedBootstrap.loadStartTime;this.postMeasurements(this.measurements);}},postMeasurements:function(measurements){if(typeof this.endPointUrl!='undefined'){$.ajax({url:this.endPointUrl,type:'POST',global:false,data:JSON.stringify(measurements),contentType:'application/json; charset=utf-8',headers:{'x-mp-xsrf':this.xsrfToken},error:function(jqXHR,textStatus,errorThrown){if(textStatus){throw new Error('Sitespeed Endpoint '+errorThrown);}}});}}});window.sitespeedCollector=new SpeedStatsCollector(window);window.sitespeedCollector.init();