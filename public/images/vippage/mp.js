
var AURORA={originalAjax:(function(){var ajax=$.ajax;$.ajax=function(options){if(options.global===undefined){options.global=true;}
var xhr=ajax(options);xhr.success(function(data){if(options.global){mp.PubSub.publish('ajax-success',[this,data]);}});xhr.error(function(data){if(options.global){mp.PubSub.publish('ajax-error',[this,data]);}});return xhr;};return ajax;}()),defaultAjaxErrorHandler:function(){var pageContentElement=$('#content'),globalAjaxErrorMessage=$('#error-global-ajax-message'),messageScriptContent=$($('#error-global-ajax').text().trim());if(globalAjaxErrorMessage.length===0){pageContentElement.prepend(messageScriptContent);messageScriptContent.show();}
window.scrollTo(0,1);},defaultAjaxSuccessHandler:function(){var globalAjaxErrorMessage=$('#error-global-ajax-message');globalAjaxErrorMessage.remove();},nameSpace:{create:function(nsString){var parts=nsString.split('.'),parent=AURORA,i;if(parts[0]==='AURORA'){parts=parts.slice(1);}
for(i=0;i<parts.length;i+=1){if(typeof parent[parts[i]]==='undefined'){parent[parts[i]]={};}
parent=parent[parts[i]];}
return parent;}}};AURORA.nameSpace.create("AURORA.templates");AURORA.googleAnalyticsManager=(function(jQuery,W){W.dataLayer=W.dataLayer||[];var $=jQuery,Constr,bodyEl=$('body'),extractDecodedElementsFrom=function(encodedString){return $(encodedString.split(",")).map(function(){return decodeURIComponent(this);});},pushCustomVariables=function(customVariablesString){var customVariables=parseCustomVariablesString(customVariablesString);for(var index in customVariables){var customVariable=customVariables[index];pushCustomVariable(index,customVariable.name,customVariable.value,customVariable.scope);}},pushCustomVariable=function(index,name,value,scope){_gaq.push(['_setCustomVar',index,name,value,scope]);},deleteCustomVariable=function(index){_gaq.push(['_deleteCustomVar',index]);},pushTrackPageView=function(url){_gaq.push(['_trackPageview',url]);},pushTrackEvent=function(eventString,el){var eventData=extractDecodedElementsFrom(eventString);if(eventData.length!==3){throw"AURORA.googleAnalyticsManager requires category, action and label in an event attribute, however an attributes contains "+eventString;}
var category=eventData[0];var action=eventData[1];var label=eventData[2];if(el&&$(el).attr("href")&&$(el).attr("href").indexOf("mailto")!==-1){_.delay(_.bind(function(){_gaq.push(['_trackEvent',category,action,label]);pushDataLayerEvent(action,label);},this),200);}else{_gaq.push(['_trackEvent',category,action,label]);pushDataLayerEvent(action,label);}},pushDataLayerEvent=function(action,label){W.dataLayer.push({'event':action,'eventLabel':label,'uaNonInt':1});},bindTrackedPageViews=function(el){var trackElements=el.find('a[data-ga-track-page-view]');trackElements.each(function(){var el=$(this),pageViewUrl=el.data('ga-track-page-view'),outboundLink=el.data('ga-outbound-link'),linkCustomVariables=el.data('ga-track-page-view-custom-variables'),pageCustomVariables=bodyEl.data('ga-custom-variables');if(pageViewUrl.length>0){el.bind('click',function(evt){if(outboundLink!==undefined){evt.preventDefault();_.delay(_.bind(function(){document.location=this.href;},this),100);}
if(linkCustomVariables){pushCustomVariables(linkCustomVariables);}
pushTrackPageView(pageViewUrl);if(linkCustomVariables){restorePageCustomVariables(pageCustomVariables,linkCustomVariables);}});}else{throw"AURORA.googleAnalyticsManager requires a data-ga-track-page-view attribute to not be empty";}});},parseCustomVariablesString=function(customVariablesString){var result=[];var customVariablesData=customVariablesString.split("&");$(customVariablesData).each(function(){var customVariableString=this;var customVariableData=extractDecodedElementsFrom(customVariableString);if(customVariableData.length!==4){throw"AURORA.googleAnalyticsManager requires index, name, value and scope in a custom variable, however an attribute contains "+customVariableString;}
var index=customVariableData[0];result[index]={name:customVariableData[1],value:customVariableData[2],scope:customVariableData[3]};});return result;},restorePageCustomVariables=function(pageCustomVariablesString,linkCustomVariablesString){var pageCustomVariables=parseCustomVariablesString(pageCustomVariablesString);var linkCustomVariables=parseCustomVariablesString(linkCustomVariablesString);for(var index in linkCustomVariables){var pageCustomVariable=pageCustomVariables[index];if(pageCustomVariable){pushCustomVariable(index,pageCustomVariable.name,pageCustomVariable.value,pageCustomVariable.scope);}else{deleteCustomVariable(index);}}},bindTrackedEvents=function(el){var trackElements=el.find('a[data-ga-track-event], button[data-ga-track-event]');trackElements.each(function(){var el=$(this);var outboundLink=el.data('ga-outbound-link');el.bind('click',function(evt){if(outboundLink!==undefined){evt.preventDefault();setTimeout('document.location = "'+this.href+'"',100);}
pushTrackEvent(el.data('ga-track-event'),el);});});},registerCustomVariablesOnLoadOf=function(el){var elementsWithCustomVariables=el.find('*[data-ga-custom-variables]');elementsWithCustomVariables.each(function(){pushCustomVariables($(this).data('ga-custom-variables'));});},trackPageViewsOnLoadOf=function(el){var elementsWithPageView=el.find('*[data-ga-page-view-url]');elementsWithPageView.each(function(){pushTrackPageView($(this).data('ga-page-view-url'));});},trackEventsOnLoadOf=function(el){var elementsWithOnLoadEvents=el.find('*[data-ga-on-load-events]');elementsWithOnLoadEvents.each(function(){var onLoadEvents=$(this).data('ga-on-load-events').split('&');$.each(onLoadEvents,function(){pushTrackEvent(this);});});},registerCustomVariablesAndTrackOperationsOnLoadOf=function(el){registerCustomVariablesOnLoadOf(el);trackPageViewsOnLoadOf(el);trackEventsOnLoadOf(el);},fireOperationsOnAction=function(el,action){var pageView=el.data('ga-track-page-view-on-'+action);if(pageView){pushTrackPageView(pageView);}
var event=el.data('ga-track-event-on-'+action);if(event){pushTrackEvent(event);}},initialiseQueue=function(){_gaq=W._gaq||[];},setAccountAndDomain=function(){_gaq.push(['_setAccount',bodyEl.data('ga-account')]);_gaq.push(['_setDomainName',bodyEl.data('ga-domain')]);_gaq.push(['_setAllowLinker',true]);},checkForInternalCampaignPage=function(){var internalCampaignIndex=location.search.indexOf("icn=");if(internalCampaignIndex!==-1){var campaignParam=W.location.search.substring(internalCampaignIndex).split('&')[0],campaignValue=campaignParam.split('=')[1];_gaq.push(['_setCustomVar','11','InternalCampaign',campaignValue,'3']);}},createGoogleAnalyticsScriptTag=function(){var gaUrl='https:'===document.location.protocol?bodyEl.data('ga-secure-js'):bodyEl.data('ga-unsecure-js'),script=document.createElement("script");script.id="analyticsScript";script.type="text/javascript";script.async=true;script.src=gaUrl;var sibling=document.getElementsByTagName("script")[0];sibling.parentNode.insertBefore(script,sibling);},validateConfiguration=function(){if(bodyEl.data('ga-account')===undefined||bodyEl.data('ga-domain')===undefined){throw"AURORA.googleAnalyticsManager requires data-ga-account and data-ga-domain to be provided as body tag attributes";}
if(bodyEl.data('ga-unsecure-js')===undefined||bodyEl.data('ga-secure-js')===undefined){throw"AURORA.googleAnalyticsManager requires data-ga-unsecure-js and data-ga-secure-js to be provided as body tag attributes";}};Constr=function(o){this.elements=this.initialise(o);};Constr.prototype={constructor:AURORA.googleAnalyticsManager,version:"1.0",initialise:function(){validateConfiguration();initialiseQueue();setAccountAndDomain();checkForInternalCampaignPage();createGoogleAnalyticsScriptTag();},trackAndBindOperations:function(){registerCustomVariablesAndTrackOperationsOnLoadOf($('html'));bindTrackedPageViews($('html'));bindTrackedEvents($('html'));},trackOperationsOnLoadOf:function(el){registerCustomVariablesAndTrackOperationsOnLoadOf(el);bindTrackedPageViews(el);bindTrackedEvents(el);},fireOperationsOnSubmit:function(el){fireOperationsOnAction(el,'submit');},fireOperationsOnSuccess:function(el){fireOperationsOnAction(el,'success');},fireOperationsOnClick:function(el){fireOperationsOnAction(el,'click');},trackPageView:function(url){pushTrackPageView(url);},trackEvent:function(eventString){if(_.isArray(eventString)){_.each(eventString,function(elem){pushTrackEvent(elem);});}else{pushTrackEvent(eventString);}}};return Constr;}(jQuery,this));AURORA.enableJuiceLessLinks=function(){$('.juiceless-link').each(function(){var linkEl=$(this),linkUrl=linkEl.data('url'),linkGaTrackEvent=linkEl.data('ga-track-event')||"",linkClasses=linkEl.attr('class'),linkId=linkEl.attr('id')||"",linkBackgroundImage=linkEl.get(0).style.backgroundImage||"",linkTitle=linkEl.attr('title')||"",linkTarget=linkEl.attr("target")||"",linkText=linkEl.html(),linkCasTrackingData=linkEl.data('cas-tracking')||"",linkRelAttr=linkEl.attr("rel")||"";var newLinkTag=$('<a />');if(linkId.length>0)newLinkTag.attr({"id":linkId});if(linkTitle.length>0)newLinkTag.attr({"title":linkTitle});if(linkClasses.length>0)newLinkTag.attr({"class":linkClasses});if(linkUrl.length>0)newLinkTag.attr({"href":linkUrl});if(linkGaTrackEvent.length>0)newLinkTag.attr({"data-ga-track-event":linkGaTrackEvent});if(linkBackgroundImage.length>0)newLinkTag.css("background-image",linkBackgroundImage);if(linkText.length>0)newLinkTag.html(linkText);if(linkTarget.length>0)newLinkTag.attr({"target":linkTarget});if(linkCasTrackingData.length>0)newLinkTag.attr({"data-cas-tracking":linkCasTrackingData});if(linkRelAttr.length>0)newLinkTag.attr({"rel":linkRelAttr});linkEl.after(newLinkTag);linkEl.remove();});};AURORA.notifications=function(){$('.notification.dismiss').each(function(){$(this).on('click','.close',function(){$(this).parents('.notification').hide();});});};AURORA.CustomTracking={events:{'click':'a','submit':'form'},init:function(cookies,requestId){this.cookies=cookies;this.requestId=requestId;this.addListenerForRequests();},addListenerForRequests:function(){for(var event in this.events){if(this.events.hasOwnProperty(event)){var selector=this.events[event];$('body').on(event,selector,this.eventHandler);}}
$(document).on('ajaxSend',_.bind(function(){this.setPrevCookie();},this));},eventHandler:function(){return _.bind(function(){this.setPrevCookie();},this);},setPrevCookie:function(){var hostParts=window.location.host.split('.'),domain='.'+hostParts[hostParts.length-2]+'.'+hostParts[hostParts.length-1];this.cookies.create('prev',this.requestId,5,domain);}};AURORA.authenticatedSync=function(method,model,options){options.beforeSend=function(jqXHR){jqXHR.setRequestHeader('x-mp-xsrf',model.get('token'));};Backbone.sync.call(this,method,model,options);};AURORA.utils={isUnsupportedBrowser:function(){var bv=AURORA.Page.browser;if(!bv.browser||!bv.version){return false;}
if((bv.browser==='firefox'&&bv.version<11)||(bv.browser==='msie'&&bv.version<9)||(bv.browser==='chrome'&&bv.version<20)||(bv.browser==='safari'&&bv.version<5)||(bv.browser==='opera')){return true;}else{return false;}},isTouchDevice:function(){return'ontouchstart'in window;},unescapeHtml:function(safe){return safe.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&#034;/g,'\"').replace(/&#039;/g,'\'');}};AURORA.Cookies=function(document){this.document=document;};_.extend(AURORA.Cookies.prototype,{create:function(name,value,seconds,domain){var expires;if(!name||/^(?:expires|max\-age|path|domain|secure)$/i.test(name)){return false;}
if(seconds){var date=new Date();date.setTime(date.getTime()+(seconds*1000));expires='; expires='+date.toUTCString();}else{expires='';}
this.document.cookie=name+'='+value+expires+
(domain?'; domain='+domain:'')+'; path=/';return true;},read:function(name){return this.document.cookie.replace(new RegExp('(?:(?:^|.*;)\\s*'+
name.replace(/[\-\.\+\*]/g,'\\$&')+'\\s*\\=\\s*([^;]*).*$)|^.*$'),'$1')||null;},exists:function(name){return(new RegExp('(?:^|;\\s*)'+name.replace(/[\-\.\+\*]/g,'\\$&')+'\\s*\\=')).test(this.document.cookie);},erase:function(name,domain){if(!name||!this.exists(name)){return false;}
var currentValue=this.read(name);this.document.cookie=name+'='+currentValue+(domain?'; domain='+domain:'')+'; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';return true;}});AURORA.nameSpace.create('AURORA.Analytics.Provider');AURORA.Analytics.Provider={needsLoading:function(){return true;},buildUrlFrom:function(url){return url;}};AURORA.Analytics={_cookieManager:null,_providers:{'comscore':_.extend({},AURORA.Analytics.Provider,{needsLoading:function(cookieManager){return(cookieManager.read('ns_Cfilter')!==null)?true:false;},buildUrlFrom:function(url){url+='&amp;ns__t='+(new Date()).getTime();var referrer=document.referrer;referrer=(referrer.lastIndexOf('/')===referrer.length-1)?referrer.substring(referrer.lastIndexOf('/'),0):referrer;if(referrer.length>0){url+='&amp;ns_referrer='+escape(referrer);}
return url;}}),'mediaplex':_.extend({},AURORA.Analytics.Provider,{buildUrlFrom:function(url){return url.replace("{destinationUrl}",encodeURIComponent(window.location.href));}}),'stir':_.extend({},AURORA.Analytics.Provider)},setDependencies:function(cookieManager,document){AURORA.Analytics._cookieManager=cookieManager;AURORA.Analytics._document=document;},load:function(providerName,url){var provider=AURORA.Analytics._providers[providerName];if(provider.needsLoading(this._cookieManager)){var trackingImage=AURORA.Analytics._document.createElement('img');trackingImage.src=window.location.protocol+provider.buildUrlFrom(url);}}};var mp=_.extend(mp||{},{setMessageProvider:function(messageProvider){this.messageProvider=messageProvider;},msg:function(key,defaultMessage){var fallback=defaultMessage||"";return this.messageProvider?(this.messageProvider[key]?this.messageProvider[key]:fallback):fallback;},emptyFunction:function(){},yesFunction:function(){return true;},noFunction:function(){return false;}});mp.View=Backbone.View.extend({parentView:null,childViews:null,initialize:function(){if(!this.dependenciesInjected){this.injectDependencies();}
this.uber=this.constructor.__super__;if(this.options.observers){this.subscribe(this.options.observers);}
var childViews=_.extend({},this.childViews||{});this.childViews={};this.appendChildViews(childViews);this.init.apply(this,arguments);},injectDependencies:function(){if(this.options.dependencies!==undefined){if(_.isFunction(this.dependencyList)){this.dependencies=_.extend({},this.dependencyList(),this.options.dependencies);}else{this.dependencies=_.extend({},this.dependencyList,this.options.dependencies);}}else{if(_.isFunction(this.dependencyList)){this.dependencies=_.extend({},this.dependencyList());}else{this.dependencies=_.extend({},this.dependencyList);}}
this.dependenciesInjected=true;},init:function(){},detachChildView:function(view){_.each(_.keys(this.childViews),_.bind(function(name){if(this.childViews[name]===view){delete this.childViews[name];}},this));},remove:function(){Backbone.View.prototype.remove.call(this);_.each(_.keys(this.childViews),_.bind(function(name){this.childViews[name].remove();delete this.childViews[name];},this));if(this.parentView){this.parentView.detachChildView(this);this.parentView=null;}},replaceChildView:function(name,newView){if(this.childViews[name]){this.detachChildView(this.childViews[name]);}
this.appendChildView(name,newView);},appendChildView:function(name,view){if(view.parentView){view.parentView.detachChildView(view);}
view.parentView=this;if(this.childViews[name]){throw new Error('Child view with name '+name+' already exists.');}
this.childViews[name]=view;},appendChildViews:function(childViews){_.each(childViews,_.bind(function(childView,name){this.appendChildView(name,childView);},this));},getChildView:function(name){return this.childViews[name];},state:function(state){if(state){$(this.el).removeClass(this.states||'').addClass(state);this._state=state;this.trigger(state);}
return this._state;},subscribe:function(channel,callback){var channelClone=channel;if(!_.isString(channel)){channelClone=_.extend({},channel);_.each(_.keys(channelClone),_.bind(function(key){var fnc=_.isFunction(channelClone[key])?channelClone[key]:this[channelClone[key]];channelClone[key]=_.bind(fnc,this);},this));}
var fnc=_.isFunction(callback)?callback:this[callback];mp.PubSub.subscribe(channelClone,fnc&&_.bind(fnc,this));}});mp.Model=Backbone.Model.extend({});mp.Collection=Backbone.Collection.extend({});mp.PubSub=(function(){var channels={};var publish=function(channel,args,scope){if(channels[channel]){_.each(channels[channel],function(fnc){fnc.apply(scope,args||[]);});}
return this;};var subscribe=function(channel,callback){var channelHash=channel;if(_.isString(channel)){channelHash={};channelHash[channel]=callback;}
_.each(_.keys(channelHash),function(channel){(channels[channel]||(channels[channel]=[])).push(channelHash[channel]);});return this;};var unsubscribe=function(channel,callback){if(callback===undefined){channels[channel]=[];}else{channels[channel]=_.reject(channels[channel],function(fnc){return fnc===callback;});}};return{publish:publish,subscribe:subscribe,unsubscribe:unsubscribe};}());mp.BrowserDetect={getInformation:function(){var _searchString=function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!==-1)
return data[i].identity;}
else if(dataProp)
return data[i].identity;}},_searchVersion=function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index===-1){return;}
return parseFloat(dataString.substring(index+this.versionSearchString.length+1));},_dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"omniweb"},{string:navigator.vendor,subString:"Apple",identity:"safari",versionSearch:"Version"},{prop:window.opera,identity:"opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"icab"},{string:navigator.vendor,subString:"KDE",identity:"konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"firefox"},{string:navigator.vendor,subString:"Camino",identity:"camino"},{string:navigator.userAgent,subString:"Netscape",identity:"netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"msie",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"netscape",versionSearch:"Mozilla"}],_dataOS=[{string:navigator.platform,subString:"Win",identity:"windows"},{string:navigator.platform,subString:"Mac",identity:"mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iphone"},{string:navigator.userAgent,subString:"iPad",identity:"ipad"},{string:navigator.platform,subString:"Linux",identity:"linux"}],browser=_searchString(_dataBrowser)||"unknown",version=_searchVersion(navigator.userAgent)||_searchVersion(navigator.appVersion)||"unknown",platform=_searchString(_dataOS)||"unknown";return{"browser":browser,"version":version,"platform":platform};}};mp.Formatter={escapeXml:function(str){var escape={'<':'&lt;','>':'&gt;','&':'&amp;','\'':'&#039;','"':'&#034;'};return _.reduce(str.split(""),function(memo,character){if(escape[character]){return memo+escape[character];}else{return memo+character;}},"");},formatPrice:function(cents){if(_.isNumber(cents)){var price=(''+cents/100).replace(/(\.\d{2})[\W\w]+/g,'$1').split('').reverse().join('').replace(/(\d{3})/g,'$1,').split('').reverse().join('').replace(/^([\-]{0,1}),/,'$1').replace(/(\.\d)$/,'$1'+'0').replace(/\.$/,'.00');price=price[0]===','?price.substring(1):price;price=price.replace(/,/g,'x').replace(/\./g,',').replace(/x/g,'.');if(price.indexOf(",")===-1){price+=",00";}
return price;}
return cents;}};mp.nameSpace={create:function(nsString){var parts=nsString.split('.'),parent=mp,i;if(parts[0]==='mp'){parts=parts.slice(1);}
for(i=0;i<parts.length;i+=1){if(typeof parent[parts[i]]==='undefined'){parent[parts[i]]={};}
parent=parent[parts[i]];}
return parent;}};(function($){var loading={};$.getScriptOnce=function(script,callback){if(!loading[script]){$.getScript(script,callback);loading[script]=true;}};}(jQuery));AURORA.ApiAuthenticatedSync=function(method,collection,options){var counter=0;var thisDomainParser=document.createElement('a');thisDomainParser.href=document.URL;if('XDomainRequest'in window&&window.XDomainRequest!==null&&thisDomainParser.protocol==='http:'){var corsIe9=new AURORA.ie9CorsRequest({'baseUrl':thisDomainParser.hostname,'cookieExchangeUrl':collection.getAuthUrl(),'token':$('input[name="nl.marktplaats.xsrf.token"]').val(),'userId':collection.toJSON().userId});var successCallback=options.success,errorCallback=options.error;_.delay(function(){corsIe9.send({url:options.collection.url,body:collection.toJSON(),method:'POST',success:function(res){successCallback(res,'success',{});},error:function(res){errorCallback(res);}});},100);}else{var getToken=function(){if(AURORA.ApiAuthenticatedSync.currentToken){return AURORA.ApiAuthenticatedSync.currentToken;}
if(tokenSessionStore.get()&&tokenSessionStore.get().length>0){return tokenSessionStore.get();}
return $.ajax({type:'POST',xhrFields:{withCredentials:true},url:collection.getAuthUrl(),beforeSend:function(jqXHR){jqXHR.setRequestHeader('x-mp-xsrf',$('input[name="nl.marktplaats.xsrf.token"]').val());}}).then(function success(response){AURORA.ApiAuthenticatedSync.currentToken=response.accessToken;tokenSessionStore.set(AURORA.ApiAuthenticatedSync.currentToken);return AURORA.ApiAuthenticatedSync.currentToken;});};var tokenSessionStore={set:function(token){if(typeof(Storage)!=='undefined'){sessionStorage.setItem('mpApiToken',token);}},get:function(){if(typeof(Storage)!=='undefined'){return sessionStorage.getItem('mpApiToken');}else{return undefined;}}};var deferred=$.Deferred(),originalOptions=_.clone(options);$.when(getToken()).then(function success(token){if($.support.cors){options.beforeSend=function(jqXHR){jqXHR.setRequestHeader('Authorization','Bearer '+token);};}else{options.url=collection.url()+'?access_token='+token+'&format=json';}
$.when(Backbone.sync.call(collection,method,collection,options)).then(function success(collection,response){deferred.resolve(collection,response);},function fail(jqXHR){if(jqXHR.status===401&&counter<3){AURORA.ApiAuthenticatedSync.currentToken='';tokenSessionStore.set('');counter++;$.when(AURORA.ApiAuthenticatedSync(method,collection,originalOptions)).then(function success(collection,response){deferred.resolve(collection,response);},function fail(jqXHR){deferred.reject('Unable to retrieve feeds. XHR status: '+jqXHR.status);});}else{deferred.reject('Unable to retrieve feeds. XHR status: '+jqXHR.status);}});},function fail(){deferred.reject('Unable to obtain an API token at this time.');});return deferred.promise();}};AURORA.ApiAuthenticatedModel=mp.Model.extend({getAuthUrl:function(){return this.collection.getAuthUrl();},initialize:function(options){if(options&&options.url){this.url=options.url;}},sync:AURORA.ApiAuthenticatedSync});AURORA.ApiAuthenticatedCollection=mp.Collection.extend({model:AURORA.ApiAuthenticatedModel,sync:AURORA.ApiAuthenticatedSync,getAuthUrl:function(){return this.options.authUrl;},initialize:function(models,options){this.options=_.extend({},this.constructor.__super__.options,this.options,options);this.init.call(this,models,options);}});AURORA.Messages={'abq.message.required':'U heeft geen vraag gesteld.','abq.message.toobig':'De vraag is te lang.','asq.message.required':'U heeft geen vraag gesteld.','defaulterror':'Er is iets fout gegaan.','form.title.invalid':'Ongeldige advertentietitel.','form.email.invalid':'Geen geldig e-mailadres ingevuld.','form.password.invalid':'Onbruikbaar wachtwoord.','form.password.tooLong':'Een wachtwoord mag maximaal uit 64 karakters bestaan.','form.password.tooShort':'Een wachtwoord moet minimaal uit 6 karakters bestaan.','form.title.containsUrl':'De Advertentietitel kan geen e-mail adres of website-link bevatten.','form.title.toobig':'De advertentietitel is te lang.','form.url.invalid':'Ongeldige url.','form.login.failed':'Onjuiste combinatie e-mail en wachtwoord.','form.bid.price.invalid':'Ongeldig bod.','form.bid.price.required':'Geen bod ingevuld.','form.description.required':'Geen advertentietekst ingevuld.','form.image.invalid':'Ongeldig bestand (alleen .jpg, .jpeg, .bmp of .png).','form.image.toobig':'Bestand is te groot (>4MB).','form.numeric.range.max.invalid':'Vul maximaal {0} in','form.numeric.range.min.invalid':'Vul minimaal {0} in','form.phonenumber.invalid':'Ongeldig telefoonnummer ingevoerd.','form.phonenumber.required':'Geen telefoonnummer ingevuld.','form.phonenumber.not.allowed':'Telefoonnummer niet toegestaan.','form.postcode.invalid':'Ongeldige postcode ingevoerd.','form.postcode.required':'Geen postcode ingevuld.','form.foreignCity.required':'Geen woonplaats ingevuld.','form.foreigncity.invalidCharacters':'Foute invoer van de woonplaats, de volgende tekens zijn toegestaan: letters/geaccentueerde letters, een -streepje, \'apostrof en ,komma','form.foreigncity.invalid':'Geen of foute invoer van de woonplaats','form.foreigncity.tooManyCharacters':'U mag maximaal vijftig karakters gebruiken voor uw woonplaats.','form.country.required':'Geen land ingevuld.','form.price.invalid':'Ongeldige prijs.','form.price.range.invalid':'De maximumprijs moet hoger zijn dan de minimumprijs.','form.price.required':'Geen prijs ingevuld.','form.mileage.invalid':'Ongeldige km-stand waarde.','form.mileage.range.invalid':'De "van" waarde moet lager zijn dan de "tot" waarde.','form.mileage.required':'Geen km-stand ingevuld.','form.year.invalid':'Ongeldige bouwjaar.','form.year.range.invalid':'Het "van" bouwjaar moet lager zijn dan het "tot" bouwjaar.','form.year.required':'Geen bouwjaar ingevuld.','form.sellerName.required':'Geen naam ingevuld.','form.sellerName.invalid':'Ongeldige naam.','form.sellerName.toobig':'De naam is te lang.','form.title.required':'Geen advertentietitel ingevuld.','form.dropdown.required':'U heeft geen waarde voor dit kenmerk ingevuld.','form.input.required':'Geen waarde ingevoerd.','form.input.invalid':'Ongeldige waarde ingevoerd.','form.input.field.required':'Dit veld is verplicht.','message.error.default.header':'Het volgende is fout gegaan.','mymp.savedad.delete.confirm.multiplead.header':'Advertenties verwijderen','mymp.savedad.delete.confirm.multiplead.messageline1':'Weet u zeker dat u deze advertenties wilt verwijderen uit de lijst met bewaarde advertenties?','mymp.savedad.delete.confirm.multiplead.messageline2':'Als u biedingen heeft geplaatst op deze advertenties, worden deze ingetrokken.','mymp.savedad.delete.confirm.singlead.header':'Advertentie verwijderen','mymp.savedad.delete.confirm.singlead.messageline1':'Weet u zeker dat u deze advertentie wilt verwijderen uit de lijst met bewaarde advertenties?','mymp.savedad.delete.confirm.singlead.messageline2':'Als u biedingen heeft geplaatst op deze advertentie, worden deze ingetrokken.','mymp.savedad.delete.success.multiplead':'De advertenties zijn verwijderd van de lijst van bewaarde advertenties. Eventuele biedingen van u op deze advertenties zijn verwijderd.','mymp.savedad.delete.success.singlead':'De advertentie is verwijderd van de lijst van bewaarde advertenties. Eventuele biedingen van u op deze advertentie zijn verwijderd.','mymp.sellerad.delete.confirm.header':'Advertentie verwijderen','mymp.sellerad.delete.success.multiplead':'Uw advertenties zijn verwijderd.','mymp.sellerad.delete.success.singlead':'Uw advertentie is verwijderd.','wrong.close.ad.reason':'De opgegeven reden om de advertentie te verwijderen is niet geldig.','wrong.close.ad.noads.todelete':'Geen advertenties om te verwijderen','vip.bidding.bid.lower.than.minimum':'Uw bod is te laag.','vip.flag.ad.successful.header':'Bedankt voor uw melding!','vip.flag.ad.successful.message':'Hiermee helpt u ons Marktplaats schoon te houden. Heeft u deze advertentie per ongeluk gemeld? Geen probleem, de advertentie wordt altijd eerst bekeken door een medewerker voordat er eventueel actie wordt ondernomen.','vip.flag.ad.successful.vero.message':'Een medewerker van Marktplaats zal uw tip zo snel mogelijk behandelen.','seller.filtername.not.unique':'Deze naam is al in gebruik'};mp.setMessageProvider(AURORA.Messages);AURORA.Page=mp.View.extend({dependencyList:function(){return{BrowserDetectGetInformation:mp.BrowserDetect.getInformation,enableJuiceLessLinks:AURORA.enableJuiceLessLinks,notifications:AURORA.notifications,Analytics:AURORA.Analytics,utils:AURORA.utils,cookies:new AURORA.Cookies(document),audienceScienceManager:AURORA.audienceScienceManager,PubSub:mp.PubSub,banners:AURORA.banners,gptBanners:AURORA.gptBanners,googleAnalyticsManager:AURORA.googleAnalyticsManager,cookieOptIn:AURORA.CookieOptIn,document:document,customTracking:AURORA.CustomTracking};},initialize:function(){this.name=this.options.name;this.loadModel();this.checkLoggedInRemoveApiToken();mp.View.prototype.injectDependencies.call(this);AURORA.Page.browser=this.dependencies.BrowserDetectGetInformation();this.checkForUnsupportedBrowser();this.dependencies.enableJuiceLessLinks();this.dependencies.notifications();this.enableCustomTracking();if(this.model&&this.model.get('responsivePage')){if(!this.isTouchDevice()){$(window).scroll(_.bind(this.stickResponsiveSearchbarScrollHandler,this));}}else{if(!/(ipad)/.test(AURORA.Page.browser.platform)){$(window).scroll(_.bind(this.stickSearchbarScrollHandler,this));}}
if(this.pageHasSearchForm()){this.initSearchForm();}
if(this.options.banners){this.loadBanners();}
if(this.options.analytics){this.loadAnalytics();}
AURORA.cookieOptIn=new this.dependencies.cookieOptIn();var totalProducts=this.dependencies.cookies.read('MpShoppingCartTotalProducts');$('.shopping-cart-counter').text(totalProducts===null?0:totalProducts);this.dependencies.Analytics.setDependencies(this.dependencies.cookies,this.dependencies.document);this.tryAndLoad('comscore','comscoreUrl');this.tryAndLoad('stir','stirUrl');this.tryAndLoad('mediaplex','mediaplexNSUrl');this.tryAndLoad('mediaplex','mediaplexUrls');if(this.model&&this.model.get('audienceScience')){AURORA.audienceScienceManagerInstance=new this.dependencies.audienceScienceManager(this.model.get('audienceScience'));}
mp.View.prototype.initialize.call(this);this.dependencies.PubSub.publish('pageInitialized');},checkLoggedInRemoveApiToken:function(){if(_.isObject(this.model)){var loginStatus=this.model.get('loggedIn');if(loginStatus===false||loginStatus===undefined||loginStatus===''){if(typeof(Storage)!=='undefined'){var token=sessionStorage.getItem('mpApiToken');if(token&&token.length>0){sessionStorage.removeItem('mpApiToken');}}}}},initSearchForm:function(){this.searchForm=new mp.Form({el:$('#search-form'),onSubmit:function(){this.$el.find('input, select').filter(function(){var val=$(this).val();var placeholder=$(this).data('placeholder');return $(this).attr('name')!=='postcode'&&(val===''||val===placeholder||val==='0');}).attr('name','');}});},stickSearchbarScrollHandler:function(){var searchBox=this.$el.find('#search');if(searchBox.length===0){return;}
var isResponsive=false;if(searchBox.length===0&&$('#query-container').length===1){searchBox=$('#search-content');isResponsive=true;}
var searchContentBox=$('#search-content');var scrollY=$(window).scrollTop();var bodyY=searchBox.offset().top;var isFixed=searchBox.css('position')==='fixed';var scrollStyle={'position':'fixed','left':0,'right':0,'top':0,'z-index':10000};if(this.pageHasSearchForm()){if(scrollY>bodyY&&!isFixed){searchBox.stop().css(scrollStyle);searchContentBox.stop().css(scrollStyle);$('#header-edge').css('background-color','#F2B479');$('#header-edge').css('border-bottom','1px solid #A6784B');searchBox.after('<div id="search-placeholder"></div>');}else if(scrollY<48){if(isFixed){var yPos=((scrollY-48)<0)?0:(scrollY-48);searchBox.css('top',yPos);searchBox.css('position','relative');searchBox.css('z-index','100');yPos+=48;searchContentBox.css('position','absolute');searchContentBox.css('top',yPos);$('#header-edge').css('background-color','#E1E8F5');$('#header-edge').css('border-bottom','1px solid #E1E8F5');$('#search-placeholder').remove();}
var opacity=1;if(scrollY!==0){opacity=1-(0+(scrollY/48));}else if(scrollY<=0){opacity=1;}
if(!isResponsive){this.$el.find('#header').css('opacity',opacity);this.$el.find('#header-content').css('opacity',opacity);}}}},stickResponsiveSearchbarScrollHandler:function(){var searchBox=this.$el.find('#search-content');if(searchBox.length===0){return;}
var scrollY=$(window).scrollTop(),bodyY=searchBox.offset().top,isFixed=searchBox.css('position')==='fixed',opacity=1,scrollStyle={'position':'fixed','left':0,'right':0,'top':0,'z-index':10000};if($('#search-form .query').length===1){var headerEdge=$('#header-edge');if(scrollY>bodyY&&!isFixed){searchBox.stop().css(scrollStyle);headerEdge.css({'background-color':'#F2B479','border-bottom':'1px solid #A6784B'});searchBox.after('<div id="search-placeholder"></div>');}else if(scrollY<48){if(isFixed){var yPos=((scrollY-48)<0)?0:(scrollY-48);searchBox.css({'top':yPos,'position':'relative','z-index':'100'});headerEdge.css({'background-color':'#E1E8F5','border-bottom':'1px solid #E1E8F5'});$('#search-placeholder').remove();}
if(scrollY!==0){opacity=1-(0+(scrollY/48));}else if(scrollY<=0){opacity=1;}
this.$el.find('#header-content').css('opacity',opacity);}}},checkForUnsupportedBrowser:function(){if(!this.dependencies.utils.isUnsupportedBrowser()){return;}
var hidden=this.dependencies.cookies.read('oldbrowserwarninghidden');if(!hidden){var element=$('#unsupported-browser-warning');$('body').prepend(element);element.show();$('#unsupported-browser-warning .close-button').click(_.bind(function(){this.dependencies.cookies.create('oldbrowserwarninghidden','true',0);$('#unsupported-browser-warning').hide();},this));}},isTouchDevice:function(){return(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch);},loadModel:function(){if(!_.isUndefined(AURORA.Pages.models[this.name])){this.model=AURORA.Pages.models[this.name];delete AURORA.Pages.models[this.name];}},enableCustomTracking:function(){if(this.model){var requestId=this.model.get('requestId');if(requestId){this.dependencies.customTracking.init(this.dependencies.cookies,requestId);}}},loadBanners:function(){if(this.model!==undefined){this.dependencies.gptBanners.loadBanners(this.model.get('gptBannerData'),this.model.get('gptSingleRequest'),this.model.get('gptTest'),this.model.get('publisherProvidedId'),this.model.get('responsivePage'));}},loadAnalytics:function(){AURORA.googleAnalyticsManagerInstance=new this.dependencies.googleAnalyticsManager();AURORA.googleAnalyticsManagerInstance.trackAndBindOperations();},tryAndLoad:function(analyticsProvider,analyticsProviderUrlKey){if(this.model){var urlsFromModel=this.model.get(analyticsProviderUrlKey);if(urlsFromModel!==undefined&&urlsFromModel!==''){if($.isArray(urlsFromModel)){_.each(urlsFromModel,_.bind(function(urlFromModel){this.dependencies.Analytics.load(analyticsProvider,urlFromModel);},this));}else{this.dependencies.Analytics.load(analyticsProvider,urlsFromModel);}}}},scrollToElement:function(selector,time,verticalOffset){time=typeof(time)!=='undefined'?time:1000;verticalOffset=typeof(verticalOffset)!=='undefined'?verticalOffset:0;var element=$(selector);var offset=element.offset();var offsetTop=offset.top+verticalOffset;$('html, body').animate({scrollTop:offsetTop},time);},triggerOptimizelyCondition:function(conditionName){window.optimizely=window.optimizely||[];window.optimizelyFlags=window.optimizelyFlags||{};window.optimizelyFlags[conditionName]=true;window.optimizely.push(['activate']);window.optimizelyFlags[conditionName]=false;window.optimizelyCallbacks=window.optimizelyCallbacks||{};window.optimizelyCallbacks.pageChange=window.optimizelyCallbacks.pageChange||function(){};window.optimizelyCallbacks.pageChange(conditionName);},trackOptimizelyEvent:function(eventName,revenue){window.optimizely=window.optimizely||[];if(typeof revenue!=='undefined'){window.optimizely.push(['trackEvent',eventName,{'revenue':revenue}]);}else{window.optimizely.push(['trackEvent',eventName]);}},pageHasSearchForm:function(){return $('#search-form .query').length===1;}});AURORA.Pages={models:{},setModel:function(pageName,model){this.models[pageName]=model;mp.PubSub.publish('modelReady');}};AURORA.page=function(name,viewObj,options){var createPage=function(){var controller=false;if(_.isObject(viewObj.controller)){controller=viewObj.controller;delete viewObj.controller;}
if(_.isObject(viewObj.dependencies)){if(!_.isObject(options)){options={};}
options.dependencies=viewObj.dependencies;delete viewObj.dependencies;}
window.dataLayer=window.dataLayer||[];var page=new(AURORA.Page.extend(viewObj))(_.extend({el:$(document.body),name:name},options));AURORA.Pages[name]=page;if(controller){AURORA.Pages[name+'Controller']=new(Backbone.Router.extend(controller))();Backbone.history.start({root:controller.rootPath});}
return page;};if(window.Raven){createPage=window.Raven.wrap(createPage);}
if(AURORA.Pages[name]!==undefined){createPage();}else if(options!==undefined&&options.waitForModel){mp.PubSub.subscribe('modelReady',createPage);}else{createPage();}};mp.Urls={removeSavedAds:'/mymp/kopen/removeSavedAds.json',removeImage:'/wijzigAdvertentie/removeImage.json',uploadImage:'/syi/uploadImage.html',extendAds:'/mymp/extendAd.json',carModels:'/search/attributeconfig/{id}/AUTOMODEL.json',carAttributes:'/search/attributeconfig/{id}/all.json',carousel:'/carousel.json',paymentOverview:'/productenOverzicht.html',categories:function(l0,l1,bucket){return'/syi/categories/{l0}/{l1}/{bucket}.json'.replace('{l0}',l0).replace('{l1}',l1).replace('{bucket}',bucket);}};AURORA.nameSpace.create('AURORA.HeaderMenu');AURORA.HeaderMenu=mp.View.extend({isSideMenuVisible:false,events:{'touchstart .side-menu-button':'_showMenu','MSPointerDown .side-menu-button':'_showMenu','mousedown .side-menu-button':'_showMenu','touchstart #header *':'_preventClick','touchstart #page-wrapper.block-events *':'_preventClick','touchstart #page-wrapper':'_hideMenu','MSPointerDown #page-wrapper':'_hideMenu','mousedown #page-wrapper':'_hideMenu','click .side-menu .item':'_gotoLink','touchstart .side-menu .item':'_gotoLink','click #mp-menu .item':'_gotoLink','click #my-mp-menu-label':'_gotoLink'},init:function(){var $menuItems=_.sortBy(this.$('#header-content-wrapper li[data-side-menu]'),function(menuItem){return $(menuItem).data('side-menu');}),$sideMenuList=this.$('.side-menu > .item-frame');_.each($menuItems,function(menuItem){$sideMenuList.append($(menuItem).clone());});$('#mp-menu').hover(function(){$(this).addClass('hover');$(this).addClass('open');},function(){$(this).removeClass('hover');$(this).removeClass('open');});},_showMenu:function(){if(this.isSideMenuVisible)return;$('#page-wrapper').addClass('block-events');this.$el.addClass('init-show-side-menu');_.delay(_.bind(function(){this.$el.addClass('menu-shift');_.delay(_.bind(function(){this.isSideMenuVisible=true;},this),300);},this),100);},_hideMenu:function(){if(!this.isSideMenuVisible)return;_.delay(_.bind(function(){this.$el.removeClass('menu-shift');_.delay(_.bind(function(){this.isSideMenuVisible=false;$('#page-wrapper').removeClass('block-events');this.$el.removeClass('init-show-side-menu');},this),300);},this),100);},_preventClick:function(event){if(this.isSideMenuVisible){event.preventDefault();}},_gotoLink:function(event){if($(event.target).data('val')){document.location=$(event.target).data('val');}}});mp.Carousel=mp.View.extend({dependencyList:function(){return{PubSub:mp.PubSub,Tooltip:mp.Tooltip};},options:{vertical:false,animationLength:300,preloadBatchSize:11,batchSize:1,alwaysShowButtons:true,showTooltip:true,mustFetch:true,hideWhenEmpty:true,tooltipTemplate:function(){},imageScale:false,noImageSrc:'/aurora/res/images/no_photo_medium.png',observers:{'imageViewer:slide':'updateSelected'}},directions:{BACKWARDS:{operator:'-='},FORWARD:{operator:'+='}},events:{'click .carousel-button-previous':'scrollBackwards','click .carousel-button-next':'scrollForward','mouseover a.thumb-placeholder':'publishEvent','click a.thumb-placeholder':'publishEvent'},states:'empty non-empty',tooltipTemplate:_.template(['<div class="thumb-title ellipsis"><a href="<%= vipUrl %>"><%= title %></a></div>','<div class="thumb-price"><%= price %></div>','<div class="thumb-location"><%= location %></div>'].join('')),init:function(){_.bindAll(this,'render');$(this.el).addClass(this.options.vertical?'vertical':'horizontal');this.initData();this.initComponents();this.initTooltip();this.state('empty');},initComponents:function(){this.viewport=this.$('.carousel-viewport');this.scroller=this.$('.carousel-scroll');this.previous=this.$('.carousel-button-previous');this.next=this.$('.carousel-button-next');this.previous.addClass('disabled');this.next.addClass('disabled');},initTooltip:function(){if(this.options.showTooltip===true){this.tooltip=new this.dependencies.Tooltip({className:'tooltip tooltip-carousel',position:'bottom-right',type:'',offset:{top:20,left:20}});}},initData:function(){if(this.collection!==undefined){this.collection.bind('add',this.render);this.collection.bind('remove',this.render);this.collection.bind('reset',this.render);if(this.options.mustFetch===true){this.collection.fetch();}}},publishEvent:function(evt){this.dependencies.PubSub.publish('carousel:'+evt.type,[this,this.scroller.find(evt.target).index(),evt]);},scrollBackwards:function(){if(this.itemIndex===0){return;}
var batchSize=this.nextBatchSize!==this.options.batchSize?this.nextBatchSize:this.options.batchSize;this.itemIndex-=batchSize;this.viewport.animate(this.getAnimation(this.directions.BACKWARDS,batchSize),this.options.animationLength);this.nextBatchSize=batchSize;this.next.removeClass('disabled');if(this.itemIndex===0){this.previous.addClass('disabled');}},getAnimation:function(direction,batchSize){if(this.options.vertical===true){return{scrollTop:direction.operator+this.itemHeight*batchSize};}else{return{scrollLeft:direction.operator+this.itemWidth*batchSize};}},scrollForward:function(){if(this.itemIndex>=this.lastVisibleItemIndex){return;}
var batchSize=this.options.batchSize;if(this.lastVisibleItemIndex-this.itemIndex<this.options.batchSize){batchSize=this.lastVisibleItemIndex-this.itemIndex;}
this.itemIndex+=batchSize;_.each(_.range(this.options.batchSize),_.bind(function(){var model=this.collection.models[this.items.length];if(model){this.appendThumbnail(model);}},this));this.viewport.animate(this.getAnimation(this.directions.FORWARD,batchSize),this.options.animationLength);this.nextBatchSize=batchSize;if(this.itemIndex>=this.lastVisibleItemIndex){this.next.addClass('disabled');}
this.previous.removeClass('disabled');},render:function(){this.dependencies.PubSub.publish('carousel:loaded',[this,this.collection.models]);this.items=[];this.itemIndex=0;this.scroller.empty();_.each(this.collection.first(this.options.preloadBatchSize),_.bind(this.appendThumbnail,this));this.allItemsFit=true;if(this.items.length){this.state('non-empty');this.previous.addClass('disabled');$(this.el).show().css('visibility','visible');this.viewport.scrollLeft(0).scrollTop(0);this.setupCarousel(this.items[0]);this.lastVisibleItemIndex=this.getLastVisibleItemIndex();if(this.allItemsFit){this.next.addClass('disabled');}else{this.next.removeClass('disabled');}}else{this.state('empty');if(this.options.hideWhenEmpty){$(this.el).slideUp();}}
this.next.toggle(this.options.alwaysShowButtons||!this.allItemsFit);this.previous.toggle(this.options.alwaysShowButtons||!this.allItemsFit);this.dependencies.PubSub.publish('carousel:rendered',[this,this.collection.models]);},setupCarousel:function(firstItem){this.viewportSize=this.options.vertical===true?this.viewport.height():this.viewport.width();if(this.options.vertical===true){this.itemHeight=firstItem.outerHeight(true);if(firstItem.css('box-sizing')==='border-box'){this.itemHeight=this.itemHeight-2;}
this.allItemsFit=(this.itemHeight*this.items.length)<this.viewportSize;}else{this.itemWidth=firstItem.outerWidth(true);this.allItemsFit=(this.itemWidth*this.items.length)<this.viewportSize;}},getLastVisibleItemIndex:function(){var dimension=this.options.vertical?this.itemHeight:this.itemWidth;return(this.collection.models.length-Math.floor(this.viewportSize/dimension));},createCroppedThumbnail:function(model){var imageUrl=model.get('imageUrl'),chooseImageLink=model.get('chooseImageLink');var thumbnail=$(this.make('a',{href:model.get('vipUrl'),'class':'thumb-placeholder'}));if(!_.isUndefined(imageUrl)){thumbnail.css('background-image','url("'+imageUrl+'")');}else{if(!_.isUndefined(chooseImageLink)){thumbnail.text(chooseImageLink);}}
return thumbnail;},createScaledThumbnail:function(model){var imageUrl=model.get('imageUrl'),chooseImageLink=model.get('chooseImageLink');var outerDiv=document.createElement('div');outerDiv.setAttribute('class','l1-thumb-link-holder');var anchor=document.createElement('a');anchor.setAttribute('href',model.get('vipUrl'));if(!_.isUndefined(imageUrl)){var img=document.createElement('img');img.setAttribute('src',model.get('imageUrl'));anchor.appendChild(img);}else{if(!_.isUndefined(chooseImageLink)){anchor.appendChild(document.createTextNode(chooseImageLink));}}
outerDiv.appendChild(anchor);return $(outerDiv);},appendThumbnail:function(model){var thumbnail=this.createCroppedThumbnail(model);this.scroller.append(thumbnail);this.items.push(thumbnail);if(this.options.showTooltip===true){this.createTooltip(model,thumbnail);}},createTooltip:function(ad,thumbnail){thumbnail.data('tooltip',this.tooltipTemplate({title:ad.get('title'),price:ad.get('formattedPrice'),location:ad.get('location'),vipUrl:ad.get('vipUrl')}));this.tooltip.enable(thumbnail);},updateSelected:function(selectedIndex,direction){this.setSelected(selectedIndex);if(selectedIndex%this.options.batchSize===0){if(direction==='next'){this.scrollForward();}else if(direction==='prev'){this.scrollBackwards();}}},setSelected:function(selectedIndex){var items=$(this.el).find('.thumb-placeholder');items.removeClass('selected').eq(selectedIndex).addClass('selected');},getSelectedIndex:function(){return $(this.el).find('.selected').index();},getElementAt:function(elementIndex){return this.scroller.children().eq(elementIndex);}});mp.List=mp.View.extend({options:{itemTag:'li',activeClass:'active',list:'.item-frame',items:'.item:not(.header)',input:'input[type=hidden]',onSelect:mp.emptyFunction,'native':'createTouch'in document,enableMouseover:false},commonEvents:{'keydown':'onKeydown','click .item:not(.header)':'onItemClick','change select':'onItemClick'},mouseoverEvents:{'mouseover  li:not(.header)':'onItemMouseOver'},buildEvents:function(){return _.extend({},this.commonEvents,(this.options.enableMouseover)?this.mouseoverEvents:{});},selectedState:false,init:function(){$(this.el).attr('tabindex','0');this.list=this.$(this.options.list);this.items=this.$(this.options.items);this.input=this.$(this.options.input);$(this.el).addClass(this.options['native']?'native':'custom');if(this.options['native']){this.renderNative();}
this.events=this.buildEvents();this.delegateEvents(this.events);return this;},render:function(model){this.list.empty();var tag,valueKey;if(this.options['native']){tag='<option></option>';valueKey='value';}else{tag='<'+this.options.itemTag+'></'+this.options.itemTag+'>';valueKey='data-val';}
_.each(this.model?this.model.toJSON().items:model,_.bind(function(item){var option=$(tag,{'class':'item '+(item.active?this.options.activeClass:''),html:item.name}).attr(valueKey,item.id);if(item.dataAttr){option.attr(item.dataAttr.name,item.dataAttr.val);}
if(item.googleAnalyticsUrl){option.attr('data-ga-track-page-view-on-click',item.googleAnalyticsUrl);}
this.list.append(option);},this));this.items=this.$(this.options.items);return this;},createNativeSelect:function(){var select=$('<select></select>',{'class':this.list.attr('class'),id:this.list.attr('id'),size:2});select.width(this.list.width()).height(this.list.height());return select;},renderNative:function(){var select=this.createNativeSelect(),input=this.input;this.items.each(function(){var option=$('<option></option>',{value:$(this).data('val'),html:$(this).text(),'class':'item'});if($(this).hasClass('active')){option.prop('selected',true);input.val($(this).data('val'));}
select.append(option);});this.items=select.children('option');this.list.replaceWith(select);this.list=select;this.delegateEvents();},active:function(){return this.items.filter('.active');},down:function(keyCode){var item=this.active();if(keyCode){var filter=function(){return $(this).text().toUpperCase().charCodeAt(0)===keyCode;};var next=this.items.filter(':gt('+this.items.index(item)+')').filter(filter).first();if(!item.length||!next.length){next=this.items.filter(filter).first();}
return next;}
return(!item.length||this.items.index(item)===this.items.length-1)?this.items.eq(0):this.items.eq(this.items.index(item)+1);},up:function(){var item=this.active();return(!item.length||this.items.index(item)===0)?this.items.eq(this.items.length-1):this.items.eq(this.items.index(item)-1);},scroll:function(item){var activeItem=item||this.active();if(activeItem.length){var offset=activeItem.position().top,height=this.list.height()-activeItem.height();if(offset<0||offset>height){this.list.scrollTop((this.list.scrollTop()+offset)-height/3);}}else{this.list.scrollTop(0);}},select:function(item){this.active().removeClass(this.options.activeClass);$(item).addClass(this.options.activeClass);var value=this.options['native']?$(item).val():$(item).data('val');this.input.val(value);if($(item).attr('tabindex')>=0){$(item).focus();}
if(!this.options['native']){this.scroll($(item));}
this.options.onSelect.call(this);},selectByValue:function(value){var item=null;var val=null;for(var k=0,i=this.items.length;k<i;k++){if(!this.options['native']){val=$(this.items[k]).data('val').toString();}else{val=$(this.items[k]).val();}
if(val===value){item=this.items[k];break;}}
if(item){if(!this.options['native']){this.select(item);if(this.setLabel){this.setLabel();}
if(this.hide){this.hide();}}else{this.$el.find('select').val(val);}}},onKeydown:function(event){if(!this.options['native']){event.preventDefault();}
this.keyAction(event);this.selectItemByKeyCode(event);},keyAction:function(event){switch(event.keyCode){case 38:this.select($(this.up()));break;case 40:this.select($(this.down()));break;}},selectItemByKeyCode:function(event){if(event.keyCode<65||event.keyCode>90){return;}
this.select(this.down(event.keyCode));},onItemClick:function(event){var target=$(event.target);if(!target.is(this.options.items)){target=target.parents(this.options.items+':first');}
if(this.options['native']){target=this.$('option:selected');}
this.select(target);if(this.options.enableMouseover){this.selectedState=true;}},onItemMouseOver:function(event){if(!this.selectedState&&this.options.enableMouseover){this.select(event.target);}}});mp.Dropdown=mp.List.extend({options:_.defaults({messages:{required:mp.msg('form.dropdown.required')},label:'.label',pointer:'.pointer',onItemChange:null,enableChildBlurFocusEvents:false},mp.List.prototype.options),states:'open closed enabled disabled',init:function(){this.label=this.$(this.options.label);this.pointer=this.$(this.options.pointer);this.marker=new mp.Marker(this.$el,this.options.styles);_.bindAll(this,'deferredHide','validate');this.addCustomEvents();this.initForm();return this;},initForm:function(){if(this.options.form)this.options.form.addField(this);},requiresValidation:function(){return $(this.el).is(':visible');},validate:function(){this.marker.mark(true);var isDefault=this.input.val()===this.getDefaultValue();if(this.options.required&&isDefault){this.marker.mark(false,this.options.messages.required);}},rebuildItemsList:function(categories){var activeKey=this.$el.find('.active').data('val');var itemFrame=this.$el.find('.item-frame');itemFrame.html('');var classes='';_.each(categories,_.bind(function(value,key){if(parseInt(key,10)===activeKey){classes='item active';}else{classes='item';}
itemFrame.append('<li class=\"'+classes+'\" data-val=\"'+key+'\">'+value+'</li>');},this));this.addCustomEvents();this.active();},configureFocusBehaviour:function(){if(this.options.enableChildBlurFocusEvents){this.$('*').bind('blur',this.deferredHide);}
this.$('*').bind('focus',_.bind(function(evt){$(this.el).addClass('highlighted');this.focused=true;},this));$(this.el).focus(_.bind(function(evt){$(this.el).addClass('highlighted');},this));},deferredHide:function(evt){$(this.el).removeClass('highlighted');if($(this.el).hasClass('closed'))return;_.defer(_.bind(function(){if(!this.focused){this.hide();}
this.focused=false;},this));},createNativeSelect:function(){var select=mp.List.prototype.createNativeSelect.call(this);select.attr('size',1).height(this.label.outerHeight()).width($(this.el).outerWidth());return select;},render:function(){mp.List.prototype.render.apply(this,arguments);this.label.html(this.active().html());this.configureFocusBehaviour();return this;},isOldIE:function(){var browser=mp.BrowserDetect.getInformation();var isIE=browser.browser==="MSIE"?true:false;return(isIE&&(browser.version<9));},toggle:function(event){return this.state()==="open"?this.hide(event):this.show(event);},hide:function(event){if(this.isOldIE()&&this.clone){var activeItemIdx=this.$(this.options.items).index(this.active()),items=this.clone.find(this.options.items);items.removeClass('active');$(items[activeItemIdx]).addClass('active');$(this.el).remove();if(_.isFunction(this.setElement)){this.setElement(this.clone);}else{this.el=this.clone;}
this.init();this.clone=undefined;}
this.validate();this.state('closed');this.deferredHide();return this;},addCustomEvents:function(){mp.List.prototype.init.call(this);if(!this.options['native']){var events={'blur':'deferredHide'};events['mousedown '+this.options.label]='toggle';events['mousedown '+this.options.pointer]='toggle';this.events=_.defaults(events,this.events);var active=this.active();if(active.length){this.label.text(active.text());this.input.val(active.data('val'));}
this.delegateEvents();this.configureFocusBehaviour();}},show:function(){if(this.isOldIE()){var offset=$(this.el).offset(),width=$(this.el).width(),height=$(this.el).height(),marginLeft=$(this.el).css('marginLeft');marginLeft=marginLeft!=='auto'?parseInt(marginLeft,10):0;this.clone=$(this.el).clone();$(this.el).replaceWith(this.clone).appendTo($(document.body));this.delegateEvents();this.configureFocusBehaviour();$(this.el)[0].style.cssText='width: '+width+'px;'+'height: '+height+'px;'+'left: '+(offset.left-marginLeft)+'px;'+'top: '+offset.top+'px;'+'position: absolute;'+'z-index : 200001';}
this.state("open");this.scroll();$(this.el).focus();return this;},setLabel:function(){var label=this.active().text();if(label){this.label.text(label);}
if(_.isFunction(this.options.onItemChange)){_.delay(_.bind(function(){this.options.onItemChange();},this),10);}},getLabel:function(){if(this.options['native']){return this.$('.item[value='+this.input.val()+']').text();}
return this.label.text();},keyAction:function(event){mp.List.prototype.keyAction.call(this,event);switch(event.keyCode){case 9:case 13:case 27:this.hide();this.setLabel();break;}},onItemClick:function(event){mp.List.prototype.onItemClick.call(this,event);this.setLabel();this.hide();},reset:function(){var defaultItem=this.items.first();this.input.val(this.getDefaultValue());this.active().removeClass(this.options.activeClass);if(!this.options['native']){this.label.text(defaultItem.text());this.active().removeClass(this.options.activeClass);}else{this.$el.find("option :first").prop("selected",true);}
return this;},getDefaultValue:function(){var defaultItem=this.items.first();return this.options['native']?defaultItem.val():defaultItem.data('val');},active:function(){var active=mp.List.prototype.active.call(this);return active.length?active:this.items.first();},val:function(){return this.input.val();},enable:function(){this.delegateEvents();this.state('enabled');if(this.options['native'])this.list.prop('disabled',false);return this;},disable:function(){$(this.el).unbind();this.reset().state('disabled');if(this.options['native'])this.list.prop('disabled',true);return this;}});mp.Input=mp.View.extend({options:{messages:{required:mp.msg('form.input.required'),invalid:mp.msg('form.input.invalid')},counter:undefined,counterDirection:'down',counterMax:60},commonEvents:{'change':'validate','blur':'validate','focus':'removePlaceholder','input':'inputHandler'},ie9InputEvents:{'cut':'customInputHandler','keyup':'customInputHandler'},ieLowerThan9InputEvents:{'propertychange':'inputHandler'},buildEvents:function(){var browser=mp.BrowserDetect.getInformation();var isIE=(browser.browser==="MSIE"||browser.browser==="msie")?true:false;return _.extend({},this.commonEvents,(isIE&&browser.version===9)?this.ie9InputEvents:{},(isIE&&browser.version<9)?this.ieLowerThan9InputEvents:{});},init:function(){this.marker=new mp.Marker(this.$el,this.options.styles);if($(this.el).next('.invalid.hint').length){this.format();}
this.delegateEvents(this.buildEvents());this.updateCounter();this.initPlaceholder();this.initForm();return this;},getMarker:function(){return this.marker;},initForm:function(){if(this.options.form)this.options.form.addField(this);},requiresValidation:function(){return $(this.el).is(':visible');},validate:function(event){var val=$(this.el).val(),opt=this.options;this.mark(true);if(val&&val!==$(this.el).data("placeholder")){this.format();val=$(this.el).val();}
if(opt.required&&(!$.trim(val)||val===$(this.el).data("placeholder"))){this.mark(false,opt.messages.required);}else if(val&&val!==$(this.el).data("placeholder")){if(opt.pattern&&!opt.pattern.test(val)){this.mark(false,opt.messages.invalid);}else if(opt.url){var url=opt.url.split('%value%').join(val);$.getJSON(url,_.bind(function(data){this.mark(data.valid,mp.msg(data.messageKey));},this));}else if($(this.el).attr("min")||$(this.el).attr("max")){var intValue=parseInt(val,10);if($(this.el).attr("min")&&(intValue<$(this.el).attr("min"))){this.mark(false,mp.msg("form.numeric.range.min.invalid").replace("{0}",$(this.el).attr("min")));}
if($(this.el).attr("max")&&(intValue>$(this.el).attr("max"))){this.mark(false,mp.msg("form.numeric.range.max.invalid").replace("{0}",$(this.el).attr("max")));}}}
if($(this.el).data("placeholder")&&(event&&event.type==="blur"))this.showPlaceholder();return this;},mark:function(valid,message){this.marker.mark(valid,message);},inputHandler:function(){this.filter();this.applyMask();this.convert();this.updateCounter();},customInputHandler:function(evt){switch(evt.type){case"keyup":var key=evt.which;switch(key){case 8:case 46:case 88:this.inputHandler();}
break;case"cut":this.inputHandler();break;}},updateCounter:function(){if(this.hasPlaceholder())return;var value=$(this.el).val();if((typeof value!=="undefined")&&(this.options.counter)){var max=this.options.counterMax;if(value.length>max){$(this.el).val(value.substring(0,max));}
var length=$(this.el).val().length;this.options.counter.text(this.options.counterDirection==='down'?max-length:length);}},filter:function(){if(this.hasPlaceholder())return;var val=$(this.el).val().split(''),filter=this.options.filter,appliedFilter="",caretPosition=this.getSelectionStart();if(val.length&&filter){appliedFilter=_.reject(val,function(c){return filter.test(c);}).join('');if($(this.el).val()!==appliedFilter){$(this.el).val(appliedFilter);caretPosition=caretPosition-(val.length-appliedFilter.length);this.setCaretPosition(caretPosition,caretPosition);}}},applyMask:function(){if(this.hasPlaceholder())return;var val=$(this.el).val().split(''),mask=this.options.mask,appliedMask="";while(val.length&&mask&&!mask.test(val.join(''))){val.pop();}
appliedMask=val.join('');if($(this.el).val()!==appliedMask){$(this.el).val(appliedMask);}},convert:function(){if(this.hasPlaceholder())return;var original=$(this.el).val();try{if(this.options.convert!==undefined){var converted=this.options.convert(original);if(original!==converted)$(this.el).val(converted);}}catch(e){}
return this;},format:function(){if(this.hasPlaceholder())return;var original=$(this.el).val();try{if(this.options.format!==undefined){var formatted=this.options.format(original);if(formatted!==original)$(this.el).val(formatted);}}catch(e){}
return this;},initPlaceholder:function(){if($(this.el).data("placeholder")){$(this.el).closest('form').submit(_.bind(this.removePlaceholder,this));this.showPlaceholder();}},resetPlaceHolder:function(){var text=$(this.el).data('placeholder');$(this.el).addClass('placeholder');$(this.el).val(text);},showPlaceholder:function(){var value=$(this.el).val(),text=$(this.el).data('placeholder');if(value&&value!==text)return;$(this.el).addClass('placeholder');$(this.el).val(text);},removePlaceholder:function(){if(!this.hasPlaceholder())return;$(this.el).val('');$(this.el).removeClass('placeholder');},hasPlaceholder:function(){return $(this.el).hasClass('placeholder');},getSelectionStart:function(){var inputEl=$(this.el)[0];if(inputEl.createTextRange){var range=document.selection.createRange().duplicate();range.moveEnd('character',inputEl.value.length);if(range.text==='')return inputEl.value.length;return inputEl.value.lastIndexOf(range.text);}else{return inputEl.selectionStart;}},getSelectionEnd:function(){var inputEl=$(this.el)[0];if(inputEl.createTextRange){var range=document.selection.createRange().duplicate();range.moveStart('character',-inputEl.value.length);return range.text.length;}else{return inputEl.selectionEnd;}},setCaretPosition:function(startPosition,endPosition){var inputEl=$(this.el)[0];if(inputEl.createTextRange){var range=inputEl.createTextRange();range.collapse(true);range.moveStart('character',startPosition);range.moveEnd('character',endPosition);range.select();}else if(inputEl.setSelectionRange){inputEl.focus();inputEl.setSelectionRange(startPosition,endPosition);}},focus:function(){this.setCaretPosition($(this.el).val().length,$(this.el).val().length);},setRequiredFlag:function(isRequired){this.options.required=isRequired;}});mp.PriceInput=mp.Input.extend({options:_.defaults({required:true,pattern:/^([0-9]{1,3}(\.?[0-9]{3})*)(,([0-9]{2}))$/,mask:new RegExp('(^[1-9][0-9]*'+'([,.][0-9]{0,2})?'+'$)'+'|'+'(^0'+'([,.][0-9]{0,2})?'+'$)'+'|'+'(^'+'([,.][0-9]{0,2})?'+'$)'+'|'+'(^[1-9]([0-9]{0,2})?'+'(([.]$)|([.][0-9]$)|([.][0-9]{2}$)|[.][0-9]{3})*'+'([,.][0-9]{0,2})?'+'$)'),minimumPrice:0,format:function(value){var sanitized='0'+value.replace(/\.([0-9]{1,2}$)/,',$1'),splitted=_.map(sanitized.split(','),function(part){return part.replace(/\D/g,'');}),parsedEuros=parseInt(splitted[0],10),cents=(splitted.length===2&&splitted[1].length)?splitted[1]:'00';if(parsedEuros>9999999){parsedEuros=9999999;cents='99';}
var formattedEuros=parsedEuros.toString().replace(/(\d)(?=(\d{3})+([.]|$))/g,'$1.'),formattedCents=(cents+'0').substring(0,2);return formattedEuros+','+formattedCents;},messages:{required:mp.msg('form.price.required'),invalid:mp.msg('form.price.invalid')}},mp.Input.prototype.options),validate:function(){mp.Input.prototype.validate.call(this);this.checkMinPriceTreshold();},addMinimumPriceCheckHandler:function(){this.$el.blur(_.bind(function(){if(this.minimumPrice){this.checkMinPriceTreshold();}},this));mp.PubSub.subscribe("minimum-pricetype:disabled",_.bind(function(){this.setMinPriceTreshold(0);},this));},checkMinPriceTreshold:function(){if(this.minimumPrice>0){if(this.getPriceAsFloat(this.$el.val())<this.minimumPrice){this.mark(false,"Het minimale bod dient lager te zijn dan de vraagprijs.");mp.PubSub.publish("is-minbid-entry-correct",[false]);return false;}else{mp.PubSub.publish("is-minbid-entry-correct",[true]);return true;}}else{return true;}},getPriceAsFloat:function(str){if(str){str=str.replace(".","");return parseFloat(str.replace(",",""));}else{return 0;}},setMinPriceTreshold:function(price){this.minimumPrice=this.getPriceAsFloat(price);if(this.checkMinPriceTreshold()){this.mark(true);}}});mp.MileageInput=mp.Input.extend({options:_.defaults({required:true,pattern:/^([0-9]{1,3}(\.?[0-9]{3})*)$/,mask:new RegExp('(^[1-9][0-9]*$)'+'|'+'(^[1-9]([0-9]{0,2})?'+'(([.]$)|([.][0-9]$)|([.][0-9]{2}$)|[.][0-9]{3})*$)'),format:function(value){var sanitized=value.replace(/\./,'');if(sanitized>999999){sanitized=999999;}
var formatted=sanitized.toString().replace(/(\d)(?=(\d{3})+([.]|$))/g,'$1.');return formatted;},messages:{required:mp.msg('form.mileage.required'),invalid:mp.msg('form.mileage.invalid')}},mp.Input.prototype.options),validate:function(){mp.Input.prototype.validate.call(this);var value=parseInt($(this.el).val().replace(/\./,''),10),opt=this.options;if($(this.el).attr("min")&&(value<$(this.el).attr("min"))){this.mark(false,mp.msg("form.numeric.range.min.invalid").replace("{0}",$(this.el).attr("min")));}
if($(this.el).attr("max")&&(value>$(this.el).attr("max"))){this.mark(false,mp.msg("form.numeric.range.max.invalid").replace("{0}",$(this.el).attr("max")));}}});mp.MileageInputWithPublish=mp.MileageInput.extend({options:_.defaults({required:false,format:function(value){var sanitized=value.replace(/\./,'');if(sanitized>999999){sanitized=999999;}
return sanitized;}},mp.MileageInput.prototype.options),validate:function(){var value=parseInt($(this.el).val().replace(/\./,''),10);mp.MileageInput.prototype.validate.call(this);mp.PubSub.publish('mileage:change',[value]);}});mp.PhoneNumberInput=mp.Input.extend({options:_.defaults({required:false,pattern:/^[+0][0-9]+$/,mask:/^\+?[0-9\-\(\) ]*$/,format:function(value){value=value.replace(/^\+/,'00');value=value.replace(/\D/g,'');value=value.replace(/^00/,'+');return value.substring(0,1)+value.substring(1).replace(/\D/g,'');},messages:_.defaults({required:mp.msg('form.phonenumber.required'),notAllowed:mp.msg('form.phonenumber.not.allowed'),invalid:mp.msg('form.phonenumber.invalid')},mp.Input.prototype.options.messages)},mp.Input.prototype.options),validate:function(){mp.Input.prototype.validate.call(this);var value=$(this.el).val(),opt=this.options;if(/^090[69]/.test(value)){this.mark(false,opt.messages.notAllowed);}else if((value.charAt(0)==='0'&&!/^0[89]00/.test(value)&&value.length<10)||(/^\+31/.test(value)&&value.length<12)){this.mark(false,opt.messages.invalid);}else if(/^0[89]00/.test(value)&&value.length<8){this.mark(false,opt.messages.invalid);}else if(/^\+(?!31)/.test(value)&&value.length<9){this.mark(false,opt.messages.invalid);}},isValid:function(){this.validate();return(!this.$el.hasClass("invalid"));}});mp.PostcodeInput=mp.Input.extend({options:_.defaults({required:true,pattern:/^[1-9][0-9]{3} [A-Z]{2}$/,mask:/^(([1-9])|([1-9][0-9]{1,3})|([1-9][0-9]{3} ?)|([1-9][0-9]{3} ?[a-z]{1,2}))$/i,format:function(value){return parseInt(value,10)+' '+value.match(/[a-z]+/i)[0].toUpperCase();},messages:{required:mp.msg('form.postcode.required'),invalid:mp.msg('form.postcode.invalid')}},mp.Input.prototype.options)});mp.BidInput=mp.PriceInput.extend({options:_.defaults({required:false,minimum:0.01,messages:{required:mp.msg('form.bid.price.required'),invalid:mp.msg('form.bid.price.invalid'),minimum:mp.msg('vip.bidding.bid.lower.than.minimum'),tooLow:mp.msg('vip.bidding.bid.lower.than.minimum')}},mp.PriceInput.prototype.options),validate:function(){mp.PriceInput.prototype.validate.call(this);var value=parseInt($(this.el).val().replace(/[.,]/g,''),10),opt=this.options;if(!_.isUndefined(opt.minimum)&&value<opt.minimum){this.mark(false,opt.messages.minimum);}else if($(this.el).data('current-top-bid')&&value<=$(this.el).data('current-top-bid')){this.mark(false,opt.messages.tooLow);}},validateOnClick:function(){mp.PriceInput.prototype.validate.call(this);var value=parseInt($(this.el).val().replace(/[.,]/g,''),10),opt=this.options,currentTopBid=$(this.el).data('current-top-bid'),validity=true;if(isNaN(value)){this.mark(false,opt.messages.required);validity=false;}else if(!_.isUndefined(opt.minimum)&&value<opt.minimum){this.mark(false,opt.messages.minimum);validity=false;}else if($(this.el).data('current-top-bid')&&value<=$(this.el).data('current-top-bid')){this.mark(false,opt.messages.tooLow);validity=false;}
return validity;}});mp.LicensePlateInput=mp.Input.extend({options:_.defaults({required:true,pattern132:/^(\d{1})(\D{3})(\d{2})$/,pattern231:/^(\d{2})(\D{3})(\d{1})$/,mask:new RegExp('^[a-zA-Z0-9]{0,6}$|'+'^[a-zA-Z0-9]{1}-[a-zA-Z0-9]{0,3}$|^[a-zA-Z0-9]{1}-[a-zA-Z0-9]{3}-[a-zA-Z0-9]{0,2}$|'+'^[a-zA-Z0-9]{2}-[a-zA-Z0-9]{0,2}$|^[a-zA-Z0-9]{2}-[a-zA-Z0-9]{2}-[a-zA-Z0-9]{0,2}$|'+'^[a-zA-Z0-9]{2}-[a-zA-Z0-9]{3}$|[a-zA-Z0-9]{2}-[a-zA-Z0-9]{3}-[a-zA-Z0-9]{0,1}$'),format:function(value){if(value.length===6){var pattern132Result=this.pattern132.exec(value);if(pattern132Result!==null){value=pattern132Result[1]+"-"+pattern132Result[2]+"-"+pattern132Result[3];}else{var pattern231Result=this.pattern231.exec(value);if(pattern231Result!==null){value=pattern231Result[1]+"-"+pattern231Result[2]+"-"+pattern231Result[3];}else{value=value.substring(0,2)+"-"+value.substring(2,4)+"-"+value.substring(4,6);}}}
return value;},convert:function(value){if(value.length===6&&(value.indexOf('-')===-1)){value=this.format(value);}
return value;}},mp.Input.prototype.options)});mp.NumericInput=mp.Input.extend({options:_.defaults({required:true,messages:{required:mp.msg('form.mileage.required'),invalid:mp.msg('form.numericValue.invalid')}},mp.Input.prototype.options),validate:function(){mp.Input.prototype.validate.call(this);var value=$(this.el).val();if(isNaN(value)){this.mark(false,this.options.messages.invalid);}}});mp.File=mp.Model.extend({defaults:{maxSize:0,supportedTypes:[]},read:function(callback){var file=this.attributes.file;if(window.FileReader){var reader=new FileReader();reader.onload=function(){callback(this.result);};reader.readAsDataURL(file);}else if(window.createBlobURL){callback(window.createBlobURL(file));}else if(window.createObjectURL){callback(window.createObjectURL(file));}else if(file.getAsDataURL){callback(file.getAsDataURL());}},validate:function(attrs){var file=attrs.file;if(file){if((file.size||file.fileSize)>this.attributes.maxSize){return'tooBig';}
if(this.attributes.supportedTypes.indexOf(file.type)===-1){return'typeNotSupported';}}}});mp.ImageFile=mp.File.extend({defaults:{maxSize:4*1024*1024,supportedTypes:['image/bmp','image/jpeg','image/png']}});mp.ImagePreview=mp.View.extend({options:{width:98,height:98,mainImageHeight:198,mainImageWidth:198,optimize:'quality'},init:function(){var image=new Image(),opt=this.options,el=$(this.el);image.onload=function(){el.empty();if(opt.scale&&(this.width>opt.width||this.height>opt.height)){$(this).css({'image-rendering':opt.optimize==='quality'?'optimizeQuality':'optimizeSpeed','-ms-interpolation-mode':opt.optimize==='quality'?'bicubic':'nearest-neighbor'});}
$(this).removeAttr('width').removeAttr('height');el.append(this);var browser=mp.BrowserDetect.getInformation();if(browser.browser==="MSIE"&&browser.version===7){$(this).css({"margin-top":(opt.height-$(this).height())/2});}
if(opt.complete){opt.complete();}};image.src=opt.url;}});mp.DynamicUploadForm=mp.View.extend({template:_.template(['<iframe style="display: none" name="<%= name %>" id="<%= name %>"></iframe>','<form style="display: none" action="<%= action %>" target="<%= name %>" method="post" enctype="multipart/form-data">','<input type="hidden" name="nl.marktplaats.xsrf.token" value="<%= token %>"/>','</form>'].join('')),init:function(){this.render();},render:function(){var opt=this.options,iframeName=(+new Date())+Math.floor((Math.random()*1000000)+1),fragment=$(this.template({name:iframeName,action:opt.action,token:opt.token})),el=$(this.el).append(fragment),form=el.find('form'),iframe=el.find('iframe'),inputClone=opt.input.clone(true);if(opt.additionalFields){_.each(opt.additionalFields,function(value,name){form.append($("<input type='hidden' />").val(value).attr("name",name));});}
opt.input.hide();inputClone.insertAfter(opt.input);form.append(opt.input);$(document.body).append(el);iframe.load(_.bind(this.complete,this));form.submit();this._checkStatus(iframeName,_.bind(this.complete,this));return this;},_checkStatus:function(name,abortCallback){var getDoc=function(name){var oIframe=document.getElementById(name);var oDoc=oIframe.contentWindow||oIframe.contentDocument;try{oDoc=oDoc.document;}catch(e){}
return oDoc;},interval=window.setInterval(function(){if($('#'+name).length===1){try{var readyState=getDoc(name).readyState;if(readyState==='complete')window.clearInterval(interval);}catch(e){window.clearInterval(interval);abortCallback({valid:false,messageKey:'defaulterror'});}}else{window.clearInterval(interval);}},500);},complete:function(evt){var data;if(evt.valid!==undefined&&evt.valid===false){data=evt;}else{try{data=JSON.parse(evt.target.contentWindow.document.body.innerHTML);}catch(e){data={valid:false,messageKey:'defaulterror'};}}
if(this.options.callback){this.options.callback(data);}
_.defer(_.bind(this.remove,this));}});mp.ImageUploader=mp.View.extend({options:{messages:{'typeNotSupported':mp.msg('form.image.invalid'),'tooBig':mp.msg('form.image.toobig')},msgTimeout:400,maxSize:mp.ImageFile.prototype.defaults.maxSize,supportedTypes:mp.ImageFile.prototype.defaults.supportedTypes},events:{'click .remove':'remove'},states:'loading complete invalid empty success',init:function(){_.bindAll(this,'upload','error','complete','resetFileInput');this.initInput();var url=this.$('input[name="images.urls"]').val();if(url){this.appendChildView('preview',new mp.ImagePreview({el:this.$('.thumb'),url:url,scale:true}));this.state('complete');}else{this.state('empty');}
return this;},initInput:function(){this.input=this.getInput();this.input.attr('name','imageData');this.input.bind('change',this.upload);this.supportsFileAPI=this.input.prop('files')!==undefined;},getInput:function(){return this.$('input[type="file"]');},upload:function(){this.$('.thumb').data('initialImage',this.$('.thumb').children("img"));this.$('.thumb').empty();if(this.validate()){this.state('loading');if(this.supportsFileAPI){this.addPreview();}
this.submit();}},addPreview:function(){this.file.read(_.bind(function(dataUrl){if(this.getChildView('preview')){this.detachChildView(this.getChildView('preview'));}
var preview=new mp.ImagePreview({el:this.$('.thumb'),url:dataUrl,scale:true});this.appendChildView('preview',preview);},this));},validate:function(){var isValid=true;if(this.supportsFileAPI){this.file=new mp.ImageFile({maxSize:this.options.maxSize,supportedTypes:this.options.supportedTypes});isValid=this.file.set({'file':this.input.prop('files').item(0)},{error:_.bind(this.error,this)});}
return isValid;},submit:function(additionalFields){mp.PubSub.publish("imageupload:started",[$(this.el).index()]);this.appendChildView('DUForm',this.getUploadForm(additionalFields));},getUploadForm:function(additionalFields){var formOptions={action:this.options.uploadAction,input:this.input,token:this.options.token,callback:this.complete};if(additionalFields)formOptions.additionalFields=additionalFields;return new mp.DynamicUploadForm(formOptions);},remove:function(){this.state('empty');this.$('input[name="images.urls"]').val('');this.$('input[name="images.ids"]').val('');this.$('.thumb').empty();},complete:function(data){if(data.valid){this.state('success');$(this.el).data('bigImageUrl',data.extraLargeImageUrl);this.$('input[name="images.urls"]').val(data.imageUrl);this.$('input[name="images.ids"]').val(data.id);if(this.getChildView('preview')){this.detachChildView(this.getChildView('preview'));}
var preview=new mp.ImagePreview({el:this.$('.thumb'),url:data.imageUrl,complete:_.bind(function(){_.delay(_.bind(this.state,this),this.options.msgTimeout,'complete');mp.PubSub.publish("imageupload:completed",[data.value]);},this),scale:true});this.appendChildView('preview',preview);}else{this.error(undefined,data.messageKey);}
mp.PubSub.publish("imageupload:finished",[$(this.el).index()]);this.resetFileInput();this.detachChildView(this.getChildView('DUForm'));},error:function(model,reason){this.state('invalid');this.setError(reason);this.$('.thumb').empty();if(this.$(".thumb").data("initialImage").length){this.$(".thumb").append(this.$(".thumb").data("initialImage"));_.delay(_.bind(this.state,this),5*this.options.msgTimeout,'complete');}else{this.$('input[name="images.urls"]').val('');this.$('input[name="images.ids"]').val('');_.delay(_.bind(this.state,this),5*this.options.msgTimeout,'empty');}},setError:function(reason){if(!reason||reason==='error'||reason==='defaulterror'||(reason.status&&reason.status===500)){this.$('.error').html('Fout<br>opgetreden');}else{var errorMessage=this.options.messages[reason];if(errorMessage===undefined){errorMessage=mp.msg(reason);}
this.$('.error').text(errorMessage);}},resetFileInput:function(){this.getInput().remove();$("<input type='file' autocomplete='off' />").appendTo($(this.el));this.initInput();}});mp.Overlay=mp.View.extend({init:function(){_.bindAll(this);},display:function(){if(this.options.preventDynamicSize!==true){var height=$(this.options.target).outerHeight(),width=$(this.options.target).outerWidth();$(this.el).css({'height':height+'px','line-height':height+'px','width':width+'px'});}
$(this.el).show();},hide:function(){$(this.el).hide();}});mp.Dialog=mp.View.extend({options:{minTop:50,fadeInTimeout:250,onHide:mp.emptyFunction,onShow:mp.emptyFunction,modal:true,autoCenter:false},events:{'click .close':'hide','keyup':'hideWrapper'},template:_.template(['<div class="content">','<span class="close"></span>','<h3 class="title"><%= title %></h3>','<div class="canvas">','<%= content %>','</div>','</div>','<div class="opacity-frame"></div>'].join('')),init:function(){_.bindAll(this);this.initOverlay();$(this.el).attr('tabindex','-1').addClass('dialog');if(this.options.size){$(this.el).addClass(this.options.size);}
if(this.options.autoCenter){$(window).bind('resize',_.bind(_.debounce(this.centerDialog,300),this));$(window).bind('scroll',_.bind(_.debounce(this.centerDialog,300),this));}},initOverlay:function(){var currentOverlayEl=$('#overlay');this.overlayEl=(currentOverlayEl.length&&currentOverlayEl)||$('<div />',{id:'overlay'});this.overlayEl.click(_.bind(function(evt){this.hide(evt);},this));if(currentOverlayEl.length===0){$('#page-wrapper').append(this.overlayEl);}},hideWrapper:function(evt){if(evt.which===27){this.hide(evt);}},hide:function(evt){if(evt){evt.preventDefault();}
this.overlayEl.off('click');mp.PubSub.publish('dialog:closed',[(this.options.name||null)]);this.options.onHide.apply(this,Array.prototype.slice.call(arguments));$(this.el).hide();if(this.options.modal){this.overlay().hide();}},show:function(callback){this.options.onShow();var jqEl=$(this.el);if(!jqEl.closest('html').length){jqEl.html($(this.template(this.options.templateData)));this.render();}
if(this.options.autoCenter){var dialogFixedHeight=this.options.height||'auto';jqEl.css({height:dialogFixedHeight});this.centerDialog();}else{var currentHeight=this.options.height||jqEl.height(),currentWidth=this.options.width||jqEl.width(),dialogHeight=this.options.height||'auto',dialogTop=Math.max((($(window).height()-currentHeight)/2)+$(document).scrollTop(),this.options.minTop),dialogLeft=($(document.body).width()-currentWidth)/2;jqEl.css({top:dialogTop,left:dialogLeft,height:dialogHeight});}
if(this.options.width){jqEl.css({width:this.options.width});}
_.defer(this.delayedShow,callback);},delayedShow:function(callback){var jqEl=$(this.el);jqEl.fadeIn(this.options.fadeInTimeout,function(){if(callback){callback.apply(this);}
jqEl.focus();});if(this.options.modal){this.overlay().show();}},overlay:function(){if($('.l-page').length===0){this.overlayEl.height($('#page-wrapper').height());}
this.overlayEl.on('click',_.bind(function(e){this.hide(e);},this));return this.overlayEl;},render:function(){$('body').append(this.el);return this;},centerDialog:function(){var $el=$(this.el),top=(($(window).height()-$el.height())/2)+$(document).scrollTop(),width=$el.width();var left=($(document.body).width()-width)/2;$el.css({'top':top+'px','left':left+'px'});}});mp.Form=mp.View.extend({options:{preventSuccessiveSubmit:true,onSubmit:mp.yesFunction},events:{'submit':'submit'},init:function(){this.fields=[];if(this.options.beforeSubmit){this.beforeSubmit=this.options.beforeSubmit;}},noErrorsFound:function(){var errorsFound=_.detect(this.fields,function(field){return field.requiresValidation()&&($(field.el).data('valid')==='false');});return!errorsFound;},checkErrors:function(){this.beforeSubmit();if(!this.noErrorsFound()){var firstFieldWithError=_.detect(this.fields,function(field){return $(field.el).data('valid')==='false';});if(firstFieldWithError){if(firstFieldWithError.focusEl){$(firstFieldWithError.focusEl).focus();}else{$(firstFieldWithError.el).focus();}}}},submit:function(evt){if(this.options.onPreBeforeSubmit){this.options.onPreBeforeSubmit();}
if(this.options.preventSuccessiveSubmit&&this.submitted){evt.preventDefault();return false;}
this.checkErrors();this.submitted=(this.noErrorsFound()&&_.bind(this.options.onSubmit,this)(evt));return this.submitted;},addField:function(field){this.fields.push(field);},beforeSubmit:function(){_.invoke(_.select(this.fields,function(field){return field.requiresValidation();}),'validate');}});mp.MarkerLabel=function(optOptions){this.setValues(optOptions);var span=this.span_=document.createElement('span');var div=this.div_=document.createElement('div');div.appendChild(span);div.style.cssText='position: absolute; display: none';};mp.buildMapLabels=function(){mp.MarkerLabel.prototype=new google.maps.OverlayView();mp.MarkerLabel.prototype.onAdd=function(){var pane=this.getPanes().overlayImage;pane.appendChild(this.div_);var me=this;this.listeners_=[google.maps.event.addListener(this,'position_changed',function(){me.draw();}),google.maps.event.addListener(this,'visible_changed',function(){me.draw();}),google.maps.event.addListener(this,'clickable_changed',function(){me.draw();}),google.maps.event.addListener(this,'text_changed',function(){me.draw();}),google.maps.event.addListener(this,'zindex_changed',function(){me.draw();}),google.maps.event.addDomListener(this.div_,'click',function(){if(me.get('clickable')){google.maps.event.trigger(me,'click');}})];};mp.MarkerLabel.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_);for(var i=0,I=this.listeners_.length;i<I;++i){google.maps.event.removeListener(this.listeners_[i]);}};mp.MarkerLabel.prototype.draw=function(){var projection=this.getProjection();var position=projection.fromLatLngToDivPixel(this.get('position'));var div=this.div_;div.style.left=position.x+5+'px';div.style.top=position.y-45+'px';var visible=this.get('visible');div.style.display=visible?'block':'none';var clickable=this.get('clickable');this.span_.style.cursor=clickable?'pointer':'';div.style.zIndex=parseInt(this.get('zIndex'),10)+1;this.span_.setAttribute("class","marker-label");this.span_.innerHTML=this.get('itemCount').toString();};};mp.GMap=mp.View.extend({options:{lat:0,lng:0,zoom:1,googleMapsUri:'http://maps.googleapis.com/maps/api/js?sensor=false&callback=mp.GMap.callback'},dependencyList:{PubSub:mp.PubSub},map:null,mapBounds:null,markers:[],selectedMarker:null,projection:null,overlay:null,_isMarkerOptimized:true,init:function(){this.markers=[];_.bindAll(this,'showMap');this.dependencies.PubSub.subscribe('google_map_api_available',this.showMap);if(!window.google||!window.google.maps){mp.GMap.callback=_.bind(this.dependencies.PubSub.publish,null,'google_map_api_available');$.getScriptOnce(this.options.googleMapsUri);}else{this.dependencies.PubSub.publish('google_map_api_available');}
return this;},showMap:function(){var position=new google.maps.LatLng(this.options.lat,this.options.lng);var startTime=new Date();this.map=new google.maps.Map($(this.el).get(0),{center:position,zoom:this.options.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,minZoom:6,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM},panControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}});this.overlay=new google.maps.OverlayView();this.overlay.draw=function(){};this.overlay.setMap(this.map);google.maps.event.addListener(this.map,'idle',_.bind(this._moveEndHandler,this));google.maps.event.addListener(this.map,'click',_.bind(this._mapClickHandler,this));google.maps.event.addListener(this.map,'dblclick',_.bind(this._mapClickHandler,this));google.maps.event.addListener(this.map,'zoom_changed',_.bind(this._zoomChangedHandler,this));if(AURORA.Pages.vip!==undefined){google.maps.event.addListenerOnce(this.map,'tilesloaded',function(){sendSiteSpeedData('vipGoogleMapLoadTime');});google.maps.event.addListenerOnce(this.map,'idle',function(){sendSiteSpeedData('vipGoogleMapLoadTimeUntilIdle');});var sendSiteSpeedData=function(eventName){var endTime=new Date(),timeDiff=(startTime.getTime()-endTime.getTime())*-1,timeData={'virtualUrl':$('body').data('ga-page-view-url')};timeData[eventName]=timeDiff;$.ajax({url:window.endpointUrl,type:'POST',global:false,data:JSON.stringify(timeData),contentType:'application/json; charset=utf-8',headers:{'x-mp-xsrf':$('input[name="nl.marktplaats.xsrf.token"]').val()},error:function(jqXHR,textStatus,errorThrown){if(textStatus){throw new Error('Sitespeed Endpoint '+errorThrown);}}});};}
this.dependencies.PubSub.unsubscribe('google_map_api_available',this.showMap);mp.buildMapLabels();if(this.options.marker){this.setMarkerOptimzationFlag(false);this.addMarker(this.options.marker.lat,this.options.marker.lng);}
this.addEasterEggMarker();},setMarkerOptimzationFlag:function(flag){this._isMarkerOptimized=flag;},addEasterEggMarker:function(){if(this.easterEggMarker){this.easterEggMarker.setMap(null);this.easterEggMarker=null;}
if(this.getZoom()>19){var position=new google.maps.LatLng(52.348861,4.917173);this.easterEggMarker=new google.maps.Marker({'map':this.map,'position':position,'icon':new google.maps.MarkerImage(this.options.easterEggIconUrl,null,null,new google.maps.Point(90,90),new google.maps.Size(250,250)),'optimized':true});}},addMarker:function(lat,lng,itemCount,index){var position=new google.maps.LatLng(lat,lng);var eventHandle=null;var marker=new google.maps.Marker({'map':this.map,'position':position,'icon':new google.maps.MarkerImage(this.options.unselectedIconUrl,null,null,new google.maps.Point(13,42),new google.maps.Size(26,42)),'optimized':this._isMarkerOptimized});if(typeof index!=='undefined'){var label=null;eventHandle=google.maps.event.addListener(marker,'click',_.bind(this._markerActivateHandler,this,[index,marker]));this.markers.push({'marker':marker,'eventHandle':eventHandle,'index':index,'status':'added'});if(itemCount>1){label=new mp.MarkerLabel({map:this.map});label.bindTo('position',marker);label.bindTo('visible',marker);label.bindTo('clickable',marker);label.bindTo('zIndex',marker);label.set('itemCount',itemCount);this.markers[this.markers.length-1].label=label;}}},drawMarkers:function(){},getBounds:function(){var bbox={'lat1':this.mapBounds.getNorthEast().lat(),'long1':this.mapBounds.getNorthEast().lng(),'lat2':this.mapBounds.getSouthWest().lat(),'long2':this.mapBounds.getSouthWest().lng()};return bbox;},getCenter:function(){var center=this.map.getCenter();return{'lat':center.lat(),'lng':center.lng()};},getMarkerPixelPosition:function(markerIndex){for(var k=0,i=this.markers.length;k<i;k++){if(this.markers[k].index===markerIndex){return this.projection.fromLatLngToContainerPixel(this.markers[k].marker.getPosition());}}},getWidth:function(){return this.$el.width();},panTo:function(lat,lng){this.map.panTo(new google.maps.LatLng(lat,lng));},setPosition:function(lat,lng,zoomLevel){var hasMoved=false;var currentCenter=this.map.getCenter();if(currentCenter.lat().toFixed(5)!==lat.toFixed(5)||currentCenter.lng().toFixed(5)!==lng.toFixed(5)){this.map.setCenter(new google.maps.LatLng(lat,lng));hasMoved=true;}
if(zoomLevel&&zoomLevel!==this.map.getZoom()){this.map.setZoom(zoomLevel);hasMoved=true;}
return hasMoved;},getZoom:function(){return this.map.getZoom();},setZoom:function(zoomLevel){var hasMoved=false;if(zoomLevel&&zoomLevel!==this.map.getZoom()){this.map.setZoom(zoomLevel);hasMoved=true;}
return hasMoved;},panBy:function(x,y){this.map.panBy(x,y);},postProcessMarkers:function(){this._clearOutOfBoundsMarkers();this._clearUnsetMarkers();},clearMarker:function(marker){marker.marker.setMap(null);if(marker.label){marker.label.setMap(null);}},clearMarkers:function(){for(var k=0,i=this.markers.length;k<i;k++){this.clearMarker(this.markers[k]);}
this.markers=[];},unselectSelectedMarker:function(){if(this.selectedMarker){this.selectedMarker.setMap(null);}
this.selectedMarker=null;},setZoomBasedOnRadius:function(radius){var circle=new google.maps.Circle({radius:parseInt(radius,10),center:this.map.getCenter(),strokeColor:'#FF0000',fillOpacity:0});this.map.fitBounds(circle.getBounds());},_clearUnsetMarkers:function(){var outIndexes=[];for(var k=0,i=this.markers.length;k<i;k++){if(!this.markers[k].status){this.clearMarker(this.markers[k]);outIndexes.push(k);}}
for(var s=outIndexes.length-1,l=0;s>=l;s--){this.markers.splice(outIndexes[s],1);}},_isMarkerOutOfBounds:function(marker){var pos=marker.getPosition();if(!this.mapBounds.contains(pos)){return true;}
return false;},_clearOutOfBoundsMarkers:function(){var outIndexes=[];for(var k=0,i=this.markers.length;k<i;k++){if(this._isMarkerOutOfBounds(this.markers[k].marker)){this.clearMarker(this.markers[k]);outIndexes.push(k);}}
if(this.selectedMarker&&(this._isMarkerOutOfBounds(this.selectedMarker))){this.unselectSelectedMarker();this.dependencies.PubSub.publish('icon_unselected');}
for(var s=outIndexes.length-1,l=0;s>=l;s--){this.markers.splice(outIndexes[s],1);}},_resetMarkerStatuses:function(){for(var k=0,i=this.markers.length;k<i;k++){this.markers[k].status=null;}},_zoomChangedHandler:function(){this.clearMarkers();this.addEasterEggMarker();},_moveEndHandler:function(){this.mapBounds=this.map.getBounds();this.projection=this.overlay.getProjection();this._resetMarkerStatuses();this.dependencies.PubSub.publish('map_ready',[this.getBounds()]);},_mapAlreadyClicked:false,_timeoutHandle:null,_mapClickHandler:function(){if(this._mapAlreadyClicked){this._mapAlreadyClicked=false;window.clearTimeout(this._timeoutHandle);}else{this._mapAlreadyClicked=true;this._timeoutHandle=window.setTimeout(_.bind(function(){this._mapAlreadyClicked=false;this.dependencies.PubSub.publish('map_clicked');if(this.selectedMarker){this.unselectSelectedMarker();this.dependencies.PubSub.publish('icon_unselected');}},this),300);}},_markerActivateHandler:function(args){this.unselectSelectedMarker();this.selectedMarker=new google.maps.Marker({'map':this.map,'position':args[1].getPosition(),'icon':new google.maps.MarkerImage(this.options.selectedIconUrl,null,null,new google.maps.Point(16.5,50),new google.maps.Size(33,50)),'zIndex':100000000,'optimized':this._isMarkerOptimized});this.dependencies.PubSub.publish('icon_selected',[args[0]]);}});mp.RichTextEditor=mp.View.extend({options:{width:470,height:200,required:false,onReady:mp.emptyFunction,validateOnBlur:true,markInvalid:function(msg){this.rteElement.after('<span class="invalid hint">'+msg+'</span>');},markValid:function(msg){this.rteElement.find('~ span.invalid').remove();},conversionTable:{'<br />':'\n','<br/>':'\n','[\n\t ]+$':'','^[\n\t ]+':''}},init:function(){tinyMCE.init({plugins:'paste, tabfocus',mode:'exact',elements:$(this.el).attr('id'),language:'nl',entity_encoding:'raw',paste_text_sticky:true,paste_preprocess:function(pl,o){o.content=o.content.replace(/<img[^>]*>/gi,'');},paste_postprocess:function(pl,o){this.mp={justPasted:true};o.node.innerHTML=o.node.innerHTML.replace(/\r?\n/g,'<br />');},theme:'advanced',theme_advanced_buttons1:'bold,italic,underline,bullist',theme_advanced_buttons2:'',theme_advanced_buttons3:'',theme_advanced_toolbar_location:'top',theme_advanced_toolbar_align:'left',content_css:'/aurora/res/mp/lib/tinyMce/mp-tinymce.css',width:this.options.width,height:this.options.height,force_br_newlines:true,force_p_newlines:false,forced_root_block:'',paste_text_linebreaktype:'br',setup:_.bind(function(editor){editor.onInit.add(_.bind(this._initValidation,this));editor.onInit.add(function(editor){editor.pasteAsPlainText=true;});if(this.options.onReady){this.options.onReady(editor);}
editor.onSaveContent.add(_.bind(this._adaptNewLines,this));},this)});this._initForm();},requiresValidation:function(){return true;},validate:function(){if(this.rteInstance.mp&&this.rteInstance.mp.justPasted){this.rteInstance.mp.justPasted=false;return this;}
this._mark(true);var content=$.trim($(this.rteInstance.dom.doc).text()),valid=!this.options.required||(this.options.required&&content.length!==0);if(!valid)this._mark(valid,this.options.messages.required);return this;},show:function(){$(this.el).show();},hide:function(){$(this.el).hide();},setContent:function(content){this.rteInstance.setContent(content);},save:function(){if($(this.el).data('valid')==='false'){this.state('active');return false;}
tinyMCE.activeEditor.save();this.hide();return true;},focus:function(){tinyMCE.execInstanceCommand('mceFocus',false,$(this.el).attr("id"));},_initForm:function(){if(this.options.form)this.options.form.addField(this);},_initValidation:function(){this.rteElement=$(this.el).next('.mceEditor');this.rteInstance=tinyMCE.get($(this.el).attr('id'));this.focusEl=$(this.el).siblings(".error-focus");if(this.options.validateOnBlur){if(tinyMCE.isGecko){$(this.rteInstance.getDoc()).blur(_.bind(this.validate,this));}else{$(this.rteInstance.getDoc()).find('#tinymce').blur(_.bind(this.validate,this));}}},_mark:function(valid,msg){$(this.el).data('valid',valid.toString());if(!valid){this.rteElement.addClass('invalid');this.focusEl.addClass('invalid');this.focusEl.data('valid','false');_.bind(this.options.markInvalid,this)(msg);}else{this.rteElement.removeClass('invalid');this.focusEl.removeClass('invalid');this.focusEl.data('valid','true');_.bind(this.options.markValid,this)(msg);}
return this;},_adaptNewLines:function(editor,wrapper){_.each(this.options.conversionTable,function(substitution,re){wrapper.content=wrapper.content.replace(new RegExp(re,'g'),substitution);});}});mp.Tabs=mp.View.extend({options:{indexFilter:{},hideCssClass:false,tabElementClass:null,panelContainer:$('body')},init:function(){this.tabElements=this.$el.find('.'+this.options.tabElementClass);this.panelContainer=this.options.panelContainer;this.tabElements.bind('click',_.bind(this.switchPanel,this));if(this.options.selectedIndex){var val=this.options.selectedIndex.val();this.tabElements.eq(typeof val==='number'?val:this.options.indexFilter[val]).addClass('selected');}
_.each(this.tabElements.filter(':not(.selected)'),function(tabElement){this.hide(this.panelContainer.find($(tabElement).attr('href')));},this);return this;},switchAction:function(panel){var activeTab=this.activeTab(),activePanel=this.panelContainer.find(activeTab.attr('href'));activeTab.removeClass('selected');activeTab=$(panel);activeTab.addClass('selected');this.hide(activePanel);activePanel=this.panelContainer.find(activeTab.attr('href'));this.show(activePanel);if(this.options.selectedIndex){var index=this.tabElements.index(activeTab);this.options.selectedIndex.val(this.options.indexFilter[index]||index);}
if(this.options.callback){this.options.callback(activeTab);}},switchPanel:function(evt){evt.preventDefault();this.switchAction(evt.target);},activeTab:function(){return this.tabElements.filter('.selected');},hide:function(panel){this.trigger('hide-panel',panel);if(this.options.hideCssClass){panel.addClass(this.options.hideCssClass);return;}
panel.hide();},show:function(panel){this.trigger('show-panel',panel);if(this.options.hideCssClass){panel.removeClass(this.options.hideCssClass);return;}
panel.show();}});mp.Tooltip=mp.View.extend({options:{hideDelay:0,stayOnHover:false,offset:{top:40,left:5},closeOnClick:true,tip:'',type:'info',position:''},states:'top-left top-right bottom-left bottom-right',className:"tooltip",init:function(){_.bindAll(this,'hide','show');$(this.el).html(this.options.tip||(this.options.target&&$(this.options.target).data("tooltip"))||'');this.calculateDimensions();$(document.body).append($(this.el));$(this.el).hide();if(this.options.hideDelay>0){if(this.options.stayOnHover){this.delegateEvents(_.extend({'mouseenter':'forbidHide','mouseleave':'allowHide'},this.events));}
this.hide=_.debounce(this.hide,this.options.hideDelay);}
this.origin=$(document.body).children().offset();$(this.el).addClass(this.options.type);$(window).bind("resize",_.bind(this.calculateDimensions,this));this.enable();return this;},calculateDimensions:function(){var dim=this.dimensions={};dim.width=$(this.el).width();dim.height=$(this.el).height();dim.bodyWidth=$(document.body).width();},show:function(target,evt){var pageX,pageY;if(target instanceof jQuery.Event){pageX=target.pageX;pageY=target.pageY;}else if(!target){target=this.options.target;pageX=pageY=0;}else{pageX=evt.pageX;pageY=evt.pageY;}
$(this.el).html(this.options.tip||$(target).data("tooltip"));this.calculateDimensions();var opt=this.options,dim=this.dimensions;dim.offsets={'bottom-right':{top:pageY+opt.offset.top,left:pageX+opt.offset.left},'bottom-left':{top:pageY+opt.offset.top,left:pageX-dim.width-opt.offset.left},'top-left':{top:pageY-dim.height-opt.offset.top,left:pageX-dim.width-opt.offset.left},'top-right':{top:pageY-dim.height-opt.offset.top,left:pageX}};dim.offset=dim.offsets['top-right'];if(opt.position){this.state(opt.position);}else if((dim.offset.top<0&&dim.offset.left+dim.width<dim.bodyWidth)){this.state('bottom-right');}else if((dim.offset.top<0&&dim.offset.left>0)){this.state('bottom-left');}else if((dim.offset.left+dim.width>dim.bodyWidth)){this.state('top-left');}else{this.state('top-right');}
$(this.el).offset(dim.offsets[this.state()]);_.defer(_.bind(this.deferredShow,this));},deferredShow:function(){$(this.el).show();if($(this.el).offset&&this.dimensions.offsets){$(this.el).offset(this.dimensions.offsets[this.state()]);}},hide:function(){if(!this.doNotHide){$(this.el).hide();}},toggle:function(target,shouldBeEnabled){if(shouldBeEnabled){this.enable(target);}else{this.disable(target);}},enable:function(target){target=target||this.options.target;if(target){$(target).bind({"mouseenter.tooltip":_.bind(this.show,this,target),"mouseleave.tooltip":_.bind(this.hide,this,target),"mousemove.tooltip":_.bind(this.show,this,target),"click.tooltip":this.options.closeOnClick&&_.bind(this.hide,this)});}},disable:function(target){this.hide();if(target){$(target).unbind('.tooltip');}
if(this.options.target){$(this.options.target).unbind('.tooltip');}},forbidHide:function(){this.doNotHide=true;},allowHide:function(){this.doNotHide=false;this.hide();}});mp.nameSpace.create("mp.Utilities.scrollUnderTableHeader");mp.Utilities.scrollUnderTableHeader=(function(jQuery,global){var $=jQuery,Constr,theTableId,theTable,theTableCaption,theTableHeader,tableHeaderWrapperOffset,theHeaderBlockHeight,tableLastRowOffset,tableHeaderCssObj={},tableContentCssObj={},tableHeaderWrapper,tableContentWrapper,assignObjProperties=function(tableId){theTableId=tableId;theTable=$('#'+tableId);theTableCaption=$('#'+tableId+" caption");theTableHeader=$('#'+tableId+" thead");tableHeaderWrapperOffset=theTable.offset().top;theHeaderBlockHeight=theTableCaption.height()+theTableHeader.height();tableLastRowOffset=$('#'+tableId+" tr").last().offset().top-theHeaderBlockHeight;tableHeaderCssObj={'top':0,'z-index':'1000','position':'fixed','height':theHeaderBlockHeight};tableContentCssObj={'margin-top':theHeaderBlockHeight};},addTableWrappersAndDomElements=function(){theTable.before("<div id='"+theTableId+"-table-header-wrapper'><table id='"+theTableId+"-dynamic-header-table' class='"+theTable.attr('class')+"'></table><div id='scroll-under-top-border'></div></div>");theTable.wrap("<div id='"+theTableId+"-table-content-wrapper'></div>");tableHeaderWrapper=$('#'+theTableId+'-table-header-wrapper');tableContentWrapper=$('#'+theTableId+'-table-content-wrapper');tableHeaderCssObj.width=tableContentWrapper.width();$('#'+theTableId+'-dynamic-header-table').append(theTableHeader).append(theTableCaption);theTable.css('margin-top',-1);$('#'+theTableId+'-dynamic-header-table caption').css('width',tableHeaderCssObj.width);},onTableScroll=function(){var theScrollTop=$(window).scrollTop();if(tableHeaderWrapperOffset<theScrollTop){tableHeaderWrapper.css(tableHeaderCssObj);tableContentWrapper.css(tableContentCssObj);theTableCaption.css({'background-color':'#FAD6AC','border-color':'#B1C4DF','border-style':'solid solid none','border-width':'0px'});if($('#tableActionPanel').length>0){$('#tableActionPanel').css({'background-color':'#F1F4F8'});}}
if(tableHeaderWrapperOffset>theScrollTop){tableHeaderWrapper.removeAttr('style');tableContentWrapper.removeAttr('style');}
if(tableLastRowOffset<theScrollTop){tableHeaderWrapper.css('top',tableLastRowOffset-theScrollTop);}},startWatchingTableScroll=function(){$(global).bind('scroll',onTableScroll);},stopWatchingTableScroll=function(){$(global).unbind('scroll',false);},removeTableWrappers=function(){};Constr=function(o){this.elements=this.assignProperties(o);};Constr.prototype={constructor:mp.Utilities.scrollUnderTableHeader,version:"1.0",assignProperties:function(tableId){assignObjProperties(tableId);},recalculateTableOffsets:function(){tableHeaderWrapperOffset=theTable.offset().top;},init:function(){addTableWrappersAndDomElements();startWatchingTableScroll();},stop:function(){removeTableWrappers();stopWatchingTableScroll();}};return Constr;}(jQuery,this));mp.AdCollection=mp.Collection.extend({parse:function(response){return _.map(response,function(originalAd){var ad={};ad.title=this.formatTitle(originalAd.ad.title);ad.price=this.formatPrice(originalAd.ad.price);ad.formattedPrice=originalAd.formattedPrice;ad.location=originalAd.ad.locationDescription;ad.vipUrl=originalAd.vipUrl;ad.imageUrl=originalAd.primaryImageUrl;ad.primaryImage=originalAd.primaryImage;ad.primaryImageUrl=originalAd.primaryImageUrl;return ad;},this);},formatPrice:function(price){return mp.Formatter.escapeXml(mp.Formatter.formatPrice(price));},formatTitle:function(title){if(!/\S/.test(title)){if(title===title.toUpperCase()){title=title.toLowerCase();title=title.charAt(0).toUpperCase()+title.substring(1);}
title=title.replace(/\s+/g,' ');}
return mp.Formatter.escapeXml(title);}});mp.ImageCollection=mp.Collection.extend({parse:function(imageModels){return _.map(imageModels,function(imageModel){if(imageModel instanceof Backbone.Model)return imageModel;var model={imageUrl:imageModel.urls.s,largeImageUrl:imageModel.urls.l,extraLargeImageUrl:imageModel.urls.xl,sequenceNumber:imageModel.sequenceNumber,isVideo:false};if(imageModel.urls.videoImageUrl){model.videoImageUrl=imageModel.urls.videoImageUrl;model.videoThumbImageUrl=imageModel.urls.videoThumbImageUrl;model.isVideo=true;}
return model;});}});mp.SuggestionsModel=mp.Model.extend({initialize:function(){_.bindAll(this,'jsonpCallback');},suggestionUrl:'http://kwsug.marktplaats.com/suggestions-backend/suggest',fetch:function(searchStr,cat){var dataLoader=new mp.Utilities.jsonp({url:this.suggestionUrl,params:{category:cat,prefix:searchStr},onComplete:this.jsonpCallback});},jsonpCallback:function(category,prefix,data){var sgArray=[];_.each(data,function(item,key){sgArray.push({id:key,name:item});});this.set({items:sgArray});}});mp.nameSpace.create("mp.Utilities.jsonp");mp.nameSpace.create("mp.Utilities.__c");mp.Utilities.__c=function(category,keyword,data){};mp.Utilities.jsonp=function(config){this.url=config.url;this.params=config.params;this.onComplete=config.onComplete;this.launch();};mp.Utilities.jsonp.prototype={launch:function(){var scriptId='__jsonpId';var oldScript=$(scriptId);if(oldScript.length){oldScript.remove();}
var scr=document.createElement('script');scr.id=scriptId;var srcUrl=this.url;for(var prop in this.params){if(this.params.hasOwnProperty(prop)){srcUrl+=(srcUrl.indexOf('?')===-1?"?":"&")+encodeURIComponent(prop)+"="+encodeURIComponent(this.params[prop]);}}
mp.Utilities.__c=this.onComplete;scr.src=srcUrl+"&callback="+encodeURIComponent('mp.Utilities.__c');document.getElementsByTagName('head')[0].appendChild(scr);}};mp.AutoComplete=mp.List.extend({options:_.defaults({pauseBeforeShow:200,numberOfCharsBeforeShow:1,category:0,categorySelectElement:false,leftOffsetAdjustmentElement:false,native:false,recentSearches:false,autoLeftAlign:true},mp.List.prototype.options),init:function(){this.prefix='';this.savedPrefix='';this.inputElement=this.options.inputElement;this.originalFormAction=this.inputElement.closest('form').attr('action');this.options.onSelect=this.onSelect;_.bindAll(this,'handleInputKeyUp','fetchModel','handleBlur','hideSuggestionIfUnfocused','windowResize','switchOffSuggestion','resetProcessingLoad','handleElBlur','handleElClick','handleInputBlur','handleInputFocus','deleteRecentSearches');this.inputElement.bind('keyup',this.handleInputKeyUp);this.inputElement.bind('blur',this.handleInputBlur);this.inputElement.after(this.template);this.setElement($('#auto-complete-container'));this.uber.init.apply(this,arguments);$(this.el).hide();this.list=$('#slist ul');this.model.bind('change',this.render,this);$(window).bind('resize',this.windowResize);$('#hide-suggestions-frame a').bind('click',this.switchOffSuggestion);$(this.el).bind('click',this.handleElClick);$(this.el).bind('blur',this.handleElBlur);this.inputElement.attr('autocomplete','off');if(this.options.recentSearches){this.inputElement.bind('focus',this.handleInputFocus);}},handleInputFocus:function(evt){if(this.inputElement.val()===''){this.render();}},handleElClick:function(evt){if(!this.hideSuggestionFeature){$(this.el).focus();$(this.el).addClass('is-focused');this.list.children('li').removeClass('active');}},handleElBlur:function(){$(this.el).removeClass('is-focused');setTimeout(this.hideSuggestionIfUnfocused,200);},handleInputBlur:function(){setTimeout(this.hideSuggestionIfUnfocused,200);},isFocused:function(elem){return elem===document.activeElement&&(elem.type||elem.href);},template:'<div id="auto-complete-container"><div id="slist" class="listbox"><ul class="suggestion-item-frame" id="suggestion-ul"></ul><div id="hide-suggestions-frame"><a tabindex="0" href="#" id="delete-recent-searches">Verwijderen</a><a href="#" tabindex="0" class="hide-suggestion">Verberg suggesties</a></div></div></div>',onSelect:function(){var suggestion=this.active().hasClass('recent-item')?this.active().find('.item-name-value').html():this.active().html();this.inputElement.val(suggestion);if(this.inputElement.closest('form').length>0){if(this.originalFormAction.indexOf('#lastPage/')>0){this.inputElement.closest('form').attr('action',this.originalFormAction+'/suggestionSearch');}else{this.inputElement.closest('form').attr('action',this.originalFormAction);}}},windowResize:function(){if(this.options.autoLeftAlign){var leftOffsetAdjustment=0;if(this.options.leftOffsetAdjustmentElement){leftOffsetAdjustment=this.options.leftOffsetAdjustmentElement.offset().left;}
$(this.el).css('left',this.inputElement.offset().left-leftOffsetAdjustment);}},keyAction:function(event){switch(event.keyCode){case 13:if($(event.target).closest('.item').hasClass('recent-item')){document.location=$(event.target).closest('.item').data('url');return;}
this.inputElement.val($(event.target).html());this.savedPrefix=$(event.target).html();$(this.el).hide();this.inputElement.focus();break;case 27:this.hideSuggestions();break;case 40:if(this.list.children('li').last().hasClass('active')){this.inputElement.val(this.savedPrefix);this.focusPassedFromLastSuggestion=true;this.list.children('li').removeClass('active');this.inputElement.focus();}else{this.uber.keyAction.apply(this,arguments);}
break;default:this.uber.keyAction.apply(this,arguments);}},focusPassedFromLastSuggestion:false,handleInputKeyUp:function(event){this.prefix=this.inputElement.val();this.savedPrefix=this.prefix;if(this.prefix.length===0){this.model.set({items:[]});if(!this.options.recentSearches&&this.options.recentSearches.length===0){$(this.el).hide();return;}}
if(event.keyCode===40){if($(this.el).css('display')==='block'&&!this.focusPassedFromLastSuggestion){var firstListItem=this.list.children('li:first');firstListItem.focus();this.uber.select.call(this,firstListItem);}else if(this.hideSuggestionFeature){this.hideSuggestionFeature=false;setTimeout(this.fetchModel,this.options.pauseBeforeShow);}}else if(event.keyCode===27){this.hideSuggestions();}else if(event.keyCode!==13){if(!this.hideSuggestionFeature){setTimeout(this.fetchModel,this.options.pauseBeforeShow);}}
this.focusPassedFromLastSuggestion=false;},handleBlur:function(evt){if($(evt.currentTarget).attr('class')!=='item'&&$(evt.currentTarget).attr('class')!=='recent-item item'&&$(evt.currentTarget).attr('id')!=='delete-recent-searches'){this.list.children('li').removeClass('active');setTimeout(this.hideSuggestionIfUnfocused,200);}},hideSuggestions:function(){$(this.el).hide();this.inputElement.focus();this.inputElement.val(this.savedPrefix);this.model.set({items:[]});$(this.el).removeClass('is-focused');},hideSuggestionIfUnfocused:function(){var listIsFocused=this.list.children('li').hasClass('active'),inputIsFocused=this.isFocused(this.inputElement),elIsFocused=$(this.el).hasClass('is-focused');if(!listIsFocused&&!inputIsFocused&&!elIsFocused){$(this.el).hide();$(this.el).removeClass('is-focused');}},hideSuggestionFeature:false,switchOffSuggestion:function(){$(this.el).hide();this.inputElement.focus();this.hideSuggestionFeature=true;this.inputElement.val(this.savedPrefix);this.model.set({items:[]});$(this.el).removeClass('is-focused');},onItemClick:function(event){if($(event.target).closest('.item').hasClass('recent-item')){document.location=$(event.target).closest('.item').data('url');return;}
$(this.el).removeClass('is-focused');this.inputElement.val($(event.target).html());$(this.el).hide();this.inputElement.focus();},processingLoad:false,resetProcessingLoad:function(){this.processingLoad=false;},currentlySelectedCategory:function(){if(this.options.categorySelectElement){var currentCat=this.options.categorySelectElement.attr('value');if(currentCat===undefined){currentCat=this.options.categorySelectElement.val();}
return currentCat;}else{return 0;}},fetchModel:function(){var theCurrentCategory;if(!this.processingLoad){if(this.prefix.length>this.options.numberOfCharsBeforeShow-1){if(this.options.categorySelectElement!==false&&this.options.categorySelectElement.length>0){theCurrentCategory=this.currentlySelectedCategory();}else{theCurrentCategory=this.options.category;}
this.processingLoad=true;this.model.fetch(this.prefix,theCurrentCategory);setTimeout(this.resetProcessingLoad,500);}}},render:function(){var filteredRecentSearches=this.filterRecentSearches(this.options.recentSearches,this.inputElement.val());if(filteredRecentSearches.length>0||(this.model.get('items')!==undefined&&this.model.get('items').length>0)){var leftOffsetAdjustment=0;if(this.options.leftOffsetAdjustmentElement){leftOffsetAdjustment=this.options.leftOffsetAdjustmentElement.offset().left;}
this.processingLoad=false;if(this.options.autoLeftAlign){$(this.el).css('left',this.inputElement.offset().left-leftOffsetAdjustment);}
this.renderList();$(this.el).show();if(filteredRecentSearches.length===0){$('.hide-suggestion').show();$('#delete-recent-searches').hide();}
var ListItems=this.list.children('li');ListItems.attr('tabindex',0);ListItems.bind('blur',this.handleBlur);}else{$(this.el).hide();$(this.el).removeClass('is-focused');}},filterRecentSearches:function(listArray,filter){var filterLen=filter.length,filteredArray=[],category=parseInt(this.currentlySelectedCategory(),10);if(filter===''&&category===0){return listArray;}
_.each(listArray,function(item){if((category===0||item.l1CategoryId===category||(item.l2CategoryId===category&&category>0))&&item.query.toLowerCase().substring(0,filterLen)===filter){filteredArray.push(item);}});return filteredArray;},renderList:function(){this.list.empty();var tag='<'+this.options.itemTag+'></'+this.options.itemTag+'>',valueKey='data-val',filterValue=this.inputElement.val(),filteredRecentSearches=this.filterRecentSearches(this.options.recentSearches,filterValue);if(filteredRecentSearches.length>0){$('#delete-recent-searches').unbind();_.each(filteredRecentSearches,_.bind(function(item){var queryText=item.query.toLowerCase();if(queryText.length>30){queryText=queryText.substr(0,60)+'...';}
var option=$(tag,{'class':'recent-item item '+(item.active?this.options.activeClass:''),html:'<span class="item-name-value">'+queryText+'</span> - '+'<span class="item-attributes">'+item.otherCriteria+'</span>'}).attr(valueKey,item.id);var url='';if(this.originalFormAction&&this.originalFormAction.indexOf('#lastPage/')>0){url=item.searchLink+'/recentSearch';}else{url=item.searchLink;}
option.data('url',url);this.list.append(option);},this));if(this.model.toJSON().items&&this.model.toJSON().items.length>0){this.list.append($("<div class='list-divider'></div>"));}
$('#delete-recent-searches').bind('click',this.deleteRecentSearches);$('.hide-suggestion').hide();$('#delete-recent-searches').show();}
_.each(this.model.toJSON().items,_.bind(function(item){var option=$(tag,{'class':'item '+(item.active?this.options.activeClass:''),html:item.name}).attr(valueKey,item.id);this.list.append(option);},this));this.items=this.$(this.options.items);return this;},deleteRecentSearches:function(){var postData='&nl.marktplaats.xsrf.token='+$("input[name='nl.marktplaats.xsrf.token']").attr('value');$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded',url:'/recentSearches/delete.json',data:postData,dataType:'json',success:_.bind(function(){this.options.recentSearches=false;this.render();},this)});}});mp.Range=mp.View.extend({styles:{error:{iconInside:true,iconOutside:false,textBelow:false,tooltip:true}},init:function(){this.fields=this.options.fields;if(_.isFunction(this.setElement)){this.setElement($(this.fields[0].el).parent());}else{this.el=$(this.fields[0].el).parent();}
_.bindAll(this,'validate');_.each(this.fields,function(field){field.getMarker().setStyles(field.options.styles||this.styles);field.options.tooltip=this.options.tooltip;$(field.el).blur(this.validate);},this);this.initForm();},validate:function(){var numericFields=_.map(this.fields,function(field){return parseFloat($(field.el).val().replace('.','').replace(',','.'));}),isRangeValid=!(numericFields[0]>numericFields[1]);if(!isRangeValid){_.each(this.fields,function(field){var elem=$(field.el),msg='';if(elem.data('latestErrorMessage')){msg=elem.data('latestErrorMessage').replace(mp.msg(elem.data('range')),'').replace('.<br>','');}
msg+=msg.length===0?'':'.<br>';msg+=mp.msg(elem.data('range'));field.mark((elem.data('valid')!==false)&&isRangeValid,msg);});}else{_.invoke(this.fields,'validate');}
return this;},requiresValidation:function(){return true;},initForm:function(){if(this.options.form){this.options.form.addField(this);}}});mp.nameSpace.create("mp.Utilities.tableTools");mp.Utilities.tableTools=(function(jQuery,_,mpDialog,mpOverlay,window){var $=jQuery,Dialog=mpDialog,Overlay=mpOverlay,Constr,tableId,scrollUnderHeader,tableElement,tableHeaderElement,checkBoxElements,checkboxClass,checkAllElement,toolActions,preSubmitDialog,preSubmitLoadingOverlay,preSubmitSuccessOverlay,preSubmitState,tableRowClass,tableActionPanelId,adsPostVariableName="adIds",assignProperties=function(config){tableId=config.tableId;scrollUnderHeader=config.scrollUnderHeader;if(scrollUnderHeader){tableHeaderElement=$(tableId+"-dynamic-header-table");}
tableElement=$(tableId);checkboxClass=config.checkboxClass;checkAllElement=config.checkAllElement;checkBoxElements=$("."+checkboxClass);toolActions=config.actions;tableRowClass=config.tableRowClass;tableActionPanelId=config.tableActionPanelId;if(config.adsPostVariableName!==undefined){adsPostVariableName=config.adsPostVariableName;}},setActionButtonState=function(){if($("."+checkboxClass+":checked").length>0){$.each(toolActions,function(key,action){action.actionElement.removeClass('disabled');});}else{$.each(toolActions,function(key,action){action.actionElement.addClass('disabled');});}},toggleCheckAll=function(){if(checkAllElement.prop('checked')===true){checkBoxElements.prop('checked',true);}else{checkBoxElements.prop('checked',false);}
setActionButtonState();},handleCheckBoxClick=function(){if(checkAllElement.prop('checked')===true){checkAllElement.prop('checked',false);}
setActionButtonState();},createDialogOnce=function(action){if(preSubmitDialog instanceof Dialog===false){preSubmitDialog=new Dialog({el:action.preSubmitDialog});preSubmitLoadingOverlay=new Overlay({el:action.preSubmitDialog.find('.overlay-loader'),target:action.preSubmitDialog});preSubmitSuccessOverlay=new Overlay({el:action.preSubmitDialog.find('.overlay-success'),target:action.preSubmitDialog});}},retrieveCheckElements=function(){var allCheckedElements=$('input.'+checkboxClass+':checked'),idArray=[];allCheckedElements.each(function(){if($(this).data('ad-id')){var adId=$(this).data('ad-id');idArray.push(adId);}});return idArray;},handleActionElementClick=function(action,evt){if(action.triggerExternalAction===true){var idArray=retrieveCheckElements();evt.preventDefault();action.externalAction(idArray);}else{preSubmitState=action.stateFunction();evt.preventDefault();if(preSubmitState!==false){createDialogOnce(action);var model={"numberOfCheckBoxes":retrieveCheckElements().length},preCommitMessageTitle,preCommitMessagePartOne;if(action.useMustacheTemplateForPreSubmitMessages!==undefined){preCommitMessageTitle=Mustache.render(action.messageKeys[preSubmitState].preSubmitMessages[0],model);preCommitMessagePartOne=Mustache.render(action.messageKeys[preSubmitState].preSubmitMessages[1],model);}else{preCommitMessageTitle=action.messageKeys[preSubmitState].preSubmitMessages[0];preCommitMessagePartOne=action.messageKeys[preSubmitState].preSubmitMessages[1];}
action.preSubmitDialog.find('.title').html(preCommitMessageTitle);action.preSubmitDialog.find('.pre-commit-message-part-one').html(preCommitMessagePartOne);action.preSubmitDialog.find('.pre-commit-message-part-two').html(action.messageKeys[preSubmitState].preSubmitMessages[2]);preSubmitDialog.show();}}},actionOnSuccess=function(action,idArray,data){var hideDialog,actionSuccessCallback,showConfirmationMessage;hideDialog=function(preSubmitSuccessOverlay,preSubmitDialog){preSubmitSuccessOverlay.hide();preSubmitDialog.hide();mp.PubSub.publish('table-tools:hideDialogComplete');};actionSuccessCallback=function(action){action.onSuccess(data,idArray);mp.PubSub.publish('table-tools:actionSuccessCallbackComplete');};showConfirmationMessage=function(action){$('#table-tools-feedback').html(action.messageKeys[preSubmitState].successMessage);$('#msg-success-table-tools').fadeIn('fast');if(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch){_.delay(function(){$('#msg-success-table-tools').fadeOut('fast');},2000);}};preSubmitLoadingOverlay.hide();preSubmitSuccessOverlay.display();_.delay(hideDialog,500,preSubmitSuccessOverlay,preSubmitDialog);mp.PubSub.subscribe('table-tools:hideDialogComplete',function(){_.delay(actionSuccessCallback,action.onSuccessDelay,action);});mp.PubSub.subscribe('table-tools:actionSuccessCallbackComplete',function(){_.delay(showConfirmationMessage,1000,action);});},handlePreSubmitDialogConfirmationClick=function(action){var allCheckedElements=$('input.'+checkboxClass+':checked'),idArray=[],postData='';allCheckedElements.each(function(){if($(this).data('ad-id')){var adId=$(this).data('ad-id');idArray.push(adId);postData+="&"+adsPostVariableName+"="+adId;}});postData.substring(1);preSubmitLoadingOverlay.display();postData+='&nl.marktplaats.xsrf.token='+$("input[name='nl.marktplaats.xsrf.token']").attr('value');$.ajax({type:'POST',url:action.actionUrl,data:postData,success:_.bind(actionOnSuccess,action,action,idArray),dataType:'json'});},bindEvents=function(){checkAllElement.bind("change",toggleCheckAll);checkBoxElements.bind("change",handleCheckBoxClick);$.each(toolActions,function(key,action){action.actionElement.bind('click',_.bind(handleActionElementClick,action,action));if(action.triggerExternalAction!==true){action.preSubmitDialog.find('.confirm').bind('click',_.bind(handlePreSubmitDialogConfirmationClick,action,action));}});};Constr=function(o){this.initialise(o);};Constr.prototype={constructor:mp.Utilities.tableTools,version:"1.0",initialise:function(){},init:function(config){assignProperties(config);bindEvents();setActionButtonState();},rebindCheckBoxes:function(){checkBoxElements=$("."+checkboxClass);if(checkAllElement.prop("checked")===true){checkBoxElements.prop('checked',true);}
checkBoxElements.bind("change",handleCheckBoxClick);}};return Constr;}(jQuery,_,mp.Dialog,mp.Overlay,this));mp.Menu=mp.List.extend({init:function(){this.menuContainer=$(this.el);this.triggerElement=$(this.el).find('.label');this.list=$(this.el).find('.item-frame');this.options=_.extend({},this.uber.options,{'native':false});this.uber.init.apply(this,arguments);_.bindAll(this,'handleTriggerElement','handleMenuItemLeave','onItemClick');this.triggerElement.bind('mouseenter',this.handleTriggerElement);this.triggerElement.bind('click',this.onItemClick);this.menuContainer.bind('mouseleave',this.handleMenuItemLeave);this.menuContainer.bind('blur',this.handleMenuItemLeave);},handleTriggerElement:function(){this.menuContainer.removeClass('closed').addClass('open');this.render(this.model);},handleMenuItemLeave:function(){this.menuContainer.removeClass('open').addClass('closed');this.list.hide();},render:function(model){this.list.css('width',this.menuContainer.outerWidth());this.list.show();},onItemClick:function(event){document.location=$(event.target).data('val');}});mp.CarouselImageViewer=mp.View.extend({dependencyList:function(){return{PubSub:mp.PubSub};},options:{animationLength:0,swipeAnimationLength:400,noImageSrc:'/aurora/res/images/no_photo_medium.png',observers:{'carousel:loaded':'preload','carousel:mouseover':'update'},imageSize:'large',forceLeftOrientation:false},states:'busy available',init:function(){_.bindAll(this,'update','preload','createViewerAsset');this.state('busy');this.currentIndex=0;this.totalAssets=0;if(typeof Hammer!=='undefined'){var mc=new Hammer(this.el),debouncedPrev=_.debounce(this.prevSlide,this.swipeAnimationLength),debouncedNext=_.debounce(this.nextSlide,this.swipeAnimationLength),debouncedResize=_.debounce(this.updateAfterResize,300);mc.get('swipe').set({velocity:0.1});mc.on('swiperight',_.bind(debouncedPrev,this));mc.on('swipeleft',_.bind(debouncedNext,this));$(window).on('resize',_.bind(debouncedResize,this));}},updateAfterResize:function(){this.scrollToImage(this.currentIndex,'Left',0);},preload:function(carousel,ads){if(this.options.sourceId&&this.options.sourceId===$(carousel.el).attr('id')){$(this.el).empty();this.state('available');_.each(ads,this.createViewerAsset);var noImagesAvailable=$(this.el).children('.thumb-placeholder').length===0;if(noImagesAvailable){$(this.el).append(this.getImageMarkup(this.options.noImageSrc,''));}
$(this.el).toggleClass('no-image',noImagesAvailable);if($(carousel.el).hasClass('vertical')&&this.options.forceLeftOrientation===false){$(this.el).children().css('display','block');}}},scrollToImage:function(imageIndex,orientation,animationLength){var image=$(this.el).children('.image').eq(imageIndex),animProperties={};animProperties['scroll'+orientation]=image.prop('offset'+orientation);$(this.el).stop().animate(animProperties,animationLength);this.currentIndex=imageIndex;},update:function(carousel,imageIndex,evt){if(this.options.sourceId&&this.options.sourceId===$(carousel.el).attr('id')){if(evt&&mp.EditableCarousel&&carousel instanceof mp.EditableCarousel){imageIndex=imageIndex-$(evt.target).prevAll('.empty').length;}
var orientation;if(this.options.forceLeftOrientation){orientation='Left';}else{orientation=$(carousel.el).hasClass('vertical')?'Top':'Left';}
this.scrollToImage(imageIndex,orientation,this.options.animationLength);}},addKnallerLabel:function(){if(this.options.isEtalageFeatureEnabled&&this.options.ryiMode){this.$el.append("<div id='foto-knaller'></div>");}},createViewerAsset:function(ad){if(!ad.get('isEmpty')){var imageUrl=ad.get(this.options.imageSize+'ImageUrl');var asset=this.getImageMarkup(imageUrl,ad.get('title'));$(this.el).append(asset);this.totalAssets+=1;this.addKnallerLabel();}},getImageMarkup:function(imageSrc,title){return'<div class="image"><img src="'+imageSrc+'" alt="'+title+'" /></div>';},prevSlide:function(){if(this.currentIndex>0){var prevIndex=this.currentIndex-1;this.toSlide(prevIndex);this.dependencies.PubSub.publish('imageViewer:slide',[prevIndex,'prev']);}},nextSlide:function(){var totalPhotoAssets=this.totalAssets-1;if(this.currentIndex<totalPhotoAssets){var nextIndex=this.currentIndex+1;this.toSlide(nextIndex);this.dependencies.PubSub.publish('imageViewer:slide',[nextIndex,'next']);}},toSlide:function(targetIndex){this.scrollToImage(targetIndex,'Left',this.swipeAnimationLength);}});mp.BrickWall=mp.View.extend({_brickSizes:{},options:{brickEls:null,wallEl:null,brickSpacing:10,maxBrickHeight:250,loadingEl:$('#search-results-loader'),brickBorderWidth:1},init:function(){if(_.isFunction(this.setElement)){this.setElement(this.options.wallEl);}else{this.el=this.options.wallEl;}
this.brickLabelHeight=_.isUndefined(this.options.brickLabelHeight)?30:this.options.brickLabelHeight;this._calculateBrickSizes();this._renderBrickSizes();},changeBrickSize:function(maxBrickHeight){this.options.maxBrickHeight=maxBrickHeight;this._brickSizes={};this._calculateBrickSizes();this._renderBrickSizes();},_calculateBrickSizes:function(){var wallWidth=$(this.el).width(),firstInRow=true,lastBrickSize={},rowWidthRunningTotal=0,rowNumber=1,numberOfBrickInRow=0,rowTotalWidth=0;_.each(this.options.brickEls,_.bind(function(brick){var elementId=$(brick).attr('id'),width=$(brick).data('brick-width'),height=$(brick).data('brick-height');rowTotalWidth=rowWidthRunningTotal+(this.options.brickSpacing*(numberOfBrickInRow-1));if(rowTotalWidth>wallWidth){this._scaleRow(wallWidth,rowWidthRunningTotal,rowNumber,numberOfBrickInRow);firstInRow=true;rowNumber++;rowWidthRunningTotal=0;numberOfBrickInRow=0;rowTotalWidth=0;}
if(firstInRow){width=Math.floor(width*(this.options.maxBrickHeight/height));height=this.options.maxBrickHeight;}else{width=Math.floor(width*(lastBrickSize.height/height));height=lastBrickSize.height;}
this._brickSizes[elementId]={width:width,height:height,rowNum:rowNumber};lastBrickSize=this._brickSizes[elementId];rowWidthRunningTotal=rowWidthRunningTotal+width;firstInRow=false;numberOfBrickInRow++;},this));rowTotalWidth=rowWidthRunningTotal+(this.options.brickSpacing*(numberOfBrickInRow-1));if(rowTotalWidth>wallWidth){this._scaleRow(wallWidth,rowWidthRunningTotal,rowNumber,numberOfBrickInRow);}},_scaleRow:function(wallWidth,rowWidthRunningTotal,rowNumber,numberOfBrickInRow){var wallWidthMinusSpacing=wallWidth-((numberOfBrickInRow-1)*this.options.brickSpacing),combinedBrickWidths=rowWidthRunningTotal,scaleBy=wallWidthMinusSpacing/combinedBrickWidths;_.each(this._brickSizes,function(brickObj){if(brickObj.rowNum===rowNumber){brickObj.width=Math.floor(brickObj.width*scaleBy);brickObj.height=Math.floor(brickObj.height*scaleBy);}});},_removeCssStyle:function(el){el.css('margin-left',0);el.find('img').css('margin-top',0);},_renderBrickSizes:function(){var currentRow=0,wallWidth=$(this.el).width(),brickAndSpacingWidth=0,lastBrick=null;_.each(this.options.brickEls,_.bind(function(brick){var theBrick=$(brick),elementId=theBrick.attr('id'),borderWidthAdjustment=this.options.brickBorderWidth*2;this._removeCssStyle(theBrick);theBrick.css({width:this._brickSizes[elementId].width-borderWidthAdjustment,height:this._brickSizes[elementId].height+this.brickLabelHeight-borderWidthAdjustment});var microTip=theBrick.find(".micro-tip");if(microTip.length>0){microTip.css({width:this._brickSizes[elementId].width-borderWidthAdjustment});}
theBrick.find('.brick-image').css({width:this._brickSizes[elementId].width-borderWidthAdjustment,height:this._brickSizes[elementId].height-borderWidthAdjustment});var brickImage=theBrick.find('img');if(theBrick.data('brick-height')<(theBrick.height()-this.brickLabelHeight)){brickImage.css({width:theBrick.data('brick-width')-borderWidthAdjustment,height:theBrick.data('brick-height')-borderWidthAdjustment,'margin-top':Math.floor((theBrick.height()-theBrick.data('brick-height')-this.brickLabelHeight-2)/2)});}else{brickImage.css({width:'100%',height:'100%'});}
if(currentRow!==this._brickSizes[elementId].rowNum){if(wallWidth-brickAndSpacingWidth>0&&currentRow!==0){lastBrick.css('margin-left',this.options.brickSpacing+(wallWidth-brickAndSpacingWidth)-borderWidthAdjustment);}
if(currentRow===2){this._insertBannerPlaceHolderAfter(elementId);}
currentRow=this._brickSizes[elementId].rowNum;brickAndSpacingWidth=this._brickSizes[elementId].width;}else{brickAndSpacingWidth=brickAndSpacingWidth+this._brickSizes[elementId].width+this.options.brickSpacing;theBrick.css({'margin-left':this.options.brickSpacing+'px'});}
lastBrick=theBrick;},this));$(this.el).show();this.options.loadingEl.hide();},_insertBannerPlaceHolderAfter:function(elementId){var bannerRubrieksEl=$('#banner-rubrieks');if(bannerRubrieksEl.length>0){bannerRubrieksEl.insertBefore('#'+elementId);bannerRubrieksEl.css('margin-bottom','10px');bannerRubrieksEl.css('height','100px');bannerRubrieksEl.show();}}});mp.Marker=function(el,styles){this.el=el;this.isValidFlag=true;this.setStyles(styles);};mp.Marker.prototype.defaultStyles={error:{iconInside:false,iconOutside:true,textBelow:true,tooltip:false}};mp.Marker.prototype.mark=function(valid,msg){this.isValidFlag=valid;this.el.data('valid',valid.toString());this.el.data('latestErrorMessage',msg||"");this.el.toggleClass('invalid',!valid);this.el.prev('.form-label').toggleClass('invalid',!valid);this.el.next(".icon-outside").remove();this.el.next("span.invalid.hint").remove();if(!valid){if(this.styles.error.textBelow){this.el.after('<span class="invalid hint">'+msg+'</span>');}
if(this.styles.error.iconOutside){this.el.after('<span class="icon-invalid icon-outside"></span>');}}
if(this.styles.error.iconInside){this.el.toggleClass('icon-invalid icon-inside',!valid);}
if(this.styles.error.tooltip){this.el.data('tooltip',msg);this.tooltip.toggle(this.el,!valid);}};mp.Marker.prototype.setStyles=function(styles){this.styles=_.extend({},this.defaultStyles,this.styles,styles);if(this.styles.error.tooltip===true){this.tooltip=new mp.Tooltip({type:'error'});}};mp.Marker.prototype.isValid=function(){return this.isValidFlag;};AURORA.nameSpace.create('AURORA.CookieOptIn');AURORA.CookieOptIn=mp.View.extend({options:{cookieName:'CookieOptIn',markerCookieName:'CookieV2',cookieDomain:'.marktplaats.nl',cookiePath:'/',cookieUrl:'http://marktplaats.nl/cookies',privacyUrl:'http://marktplaats.nl/privacy'},init:function(){var dateNow=new Date();var dateTwoYearsAfter=new Date();var host=document.location.host;var cookieCalculatedDomain=host.substring(host.indexOf('.'));dateTwoYearsAfter.setDate(dateNow.getDate()+730);this.options.cookieDomain=cookieCalculatedDomain;this.options.cookieExpires=dateTwoYearsAfter.toUTCString();this._checkCookieAndDisplayLayover();},_checkCookieAndDisplayLayover:function(){if(this._readCookie(this.options.cookieName)!=='true'){this._displayLayover();}},_readCookie:function(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===' '){c=c.substring(1,c.length);}
if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length);}}
return null;},_displayLayover:function(){var cookieNode=$.parseHTML(Mustache.to_html(AURORA.templates.cookieOptIn,{'cookieUrl':this.options.cookieUrl,'privacyUrl':this.options.privacyUrl}));$('body').append(cookieNode);this._elOptInButton=$('#cookie-opt-in-button');this._elOptInFooter=$('#cookie-opt-in-footer');this._elOptInButton.click(_.bind(this._setCookieAndHide,this));this._elOptInFooter.show();if(window.MIG9375FeatureEnabled&&!this._markerCookieExists()){this._setMarkerCookie();this._trackCookieBarSeen();}
if(AURORA.googleAnalyticsManagerInstance!==undefined){$('#opt-in-link-a').bind('click',function(){AURORA.googleAnalyticsManagerInstance.trackEvent('ANY,Cookie_Banner,Cookies');});$('#opt-in-link-b').bind('click',function(){AURORA.googleAnalyticsManagerInstance.trackEvent('ANY,Cookie_Banner,Cookiebeleid');});}},_setCookieAndHide:function(){if(AURORA.googleAnalyticsManagerInstance!==undefined){AURORA.googleAnalyticsManagerInstance.trackEvent('ANY,Cookie_Banner,Sluiten');}
var cookieStr=this.options.cookieName+'=true;domain='+this.options.cookieDomain+';path='+this.options.cookiePath+';expires='+this.options.cookieExpires;document.cookie=cookieStr;this._elOptInFooter.hide();this._elOptInButton.hide();},_markerCookieExists:function(){return this._readCookie(this.options.markerCookieName)==='true';},_setMarkerCookie:function(){document.cookie=this.options.markerCookieName+'=true;domain='+this.options.cookieDomain+';path='+this.options.cookiePath+';expires='+this.options.cookieExpires;},_trackCookieBarSeen:function(){}});mp.InputPair=mp.View.extend({styles:{},init:function(){this.fields=this.options.fields;_.bindAll(this,'validate');_.each(this.fields,function(field){field.getMarker().setStyles(field.options.styles||this.styles);$(field.el).blur(this.validate);},this);this.initForm();},validate:function(evt){var newEmail=$(this.fields[0].el).val().trim();var confirmEmail=$(this.fields[1].el).val().trim();if(!newEmail||!confirmEmail){return this;}
if(newEmail!==confirmEmail){_.each(this.fields,function(field){var elem=$(field.el);var msg="Vul tweemaal hetzelfde e-mailadres in.";field.mark(elem.data('valid')&&false,msg);},this);}else{_.invoke(this.fields,'validate');}
return this;},requiresValidation:function(){return true;},initForm:function(){if(this.options.form)this.options.form.addField(this);}});mp.TextEditor=mp.Input.extend({dependencyList:{Marker:mp.Marker},options:_.defaults({required:false,validateOnBlur:true},mp.Input.prototype.options),init:function(){mp.Input.prototype.init.call(this);this.uber.setElement(this.el);this.marker=new this.dependencies.Marker(this.$el,this.options.styles);},requiresValidation:function(){return true;},validate:function(evt){if((evt&&evt.type==="blur")&&(!this.options.validateOnBlur)){return;}
this.mark(true);var content=$.trim(this.getContent()),valid=!this.options.required||(this.options.required&&content.length!==0);if(this.options.required&&$(this.el).data("placeholder")&&content===$(this.el).data("placeholder")){valid=false;}
if(!valid)this.mark(valid,this.options.messages.required);return this;},show:function(){$(this.el).show();},hide:function(){this.mark(true);$(this.el).hide();},focus:function(){$(this.el).show();this.uber.focus();},save:function(){this.hide();return true;},getContent:function(){return this.$el.val().replace(/\n/gi,"<br/>");},setContent:function(content){this.$el.val(content.replace(/<br>/gi,"\n"));}});mp.CarSellBlock=mp.View.extend({options:{},childViews:{searchForm:new mp.Form({el:$('#cars-search-form'),onSubmit:function(){this.$el.find('input').filter(function(){var val=$(this).val();var placeholder=$(this).data('placeholder');return val===''||val===placeholder||val==='0';}).attr('name','');}})},init:function(){this.initForm();$('a.advanced-search').on('click',this.toggleAdvancedSearch);this.loadCarAttributes();},toggleAdvancedSearch:function(){var isAdvancedMode=$('#l1-cars-buy-sell-block.advanced').length>0,newText=$(this).text()==='Uitgebreid zoeken'?'Simpel zoeken':'Uitgebreid zoeken',newWidth=isAdvancedMode?'479px':'100%';AURORA.googleAnalyticsManagerInstance.trackEvent('L1Page,Cars_Extended search,Success');if(isAdvancedMode){$('#l1-cars-buy-sell-block').toggleClass('animating').toggleClass('animating-left');$('#l1-cars-buy-block').animate({'width':newWidth},600,function(){$('#l1-cars-buy-sell-block').toggleClass('advanced').toggleClass('animating-left').toggleClass('animating');$('a.advanced-search').text(newText);});}else{$('#l1-cars-buy-sell-block').toggleClass('advanced').toggleClass('animating-right').toggleClass('animating');$('#l1-cars-buy-block').animate({'width':newWidth},600,function(){$('#l1-cars-buy-sell-block').toggleClass('animating-right').toggleClass('animating');$('a.advanced-search').text(newText);});}},initForm:function(){var searchForm=this.getChildView('searchForm');searchForm.appendChildViews({priceRange:new mp.Range({form:searchForm,fields:[new mp.PriceInput({el:$('input[name="priceFrom"]'),required:false,form:searchForm}),new mp.PriceInput({el:$('input[name="priceTo"]'),required:false,form:searchForm})]}),yearRange:new mp.Range({form:searchForm,fields:[new mp.Input({el:$('input[name="yearFrom"]'),required:false,mask:new RegExp('^[0-9]{0,4}$'),form:searchForm}),new mp.Input({el:$('input[name="yearTo"]'),required:false,mask:new RegExp('^[0-9]{0,4}$'),form:searchForm})]}),modelsDropdown:new mp.Dropdown({el:$('#cars-search-models'),observers:{'car-models-fetched':function(items){this.render(items);if(items&&items.length===1&&items[0].id===''){this.disable();}else{this.enable();}
if(this.parentView&&this.parentView.parentView&&this.parentView.parentView.model){var selectedModelValue=this.parentView.parentView.model.get('carModelAttributeValue');this.selectByValue(selectedModelValue);}},'car-attributes-loading':function(){this.disable();}}}),categoriesDropdown:new mp.Dropdown({el:$('#cars-search-categories'),onItemChange:_.bind(this.loadCarAttributes,this)}),garantieDropdown:new mp.Dropdown({el:$('#cars-search-garantie'),observers:{'car-attributes-fetched':function(data){data.Garantie.items.unshift({name:'Geen voorkeur',id:''});this.render(data.Garantie.items);this.enable();}}}),ovbBrandDropdown:new mp.Dropdown({el:$('#cars-search-ovb-merk'),observers:{'car-attributes-fetched':function(data){var brands=data.Merk;if(brands){brands.items.unshift({name:'Alle merken&hellip;',id:''});this.render(brands.items);this.enable();}else{this.render([{id:'',name:'Kies eerst een voertuigsoort'}]);this.disable();}
if(this.parentView&&this.parentView.parentView&&this.parentView.parentView.model){var selectedModelValue=this.parentView.parentView.model.get('carModelAttributeValue');this.selectByValue(selectedModelValue);}}}}),fuelTypeDropdown:new mp.Dropdown({el:$('#cars-search-fuel-type'),observers:{'car-attributes-fetched':function(data){data.Brandstof.items.unshift({name:'Geen voorkeur',id:''});this.render(data.Brandstof.items);this.enable();}}}),sellerTypeRadioGroup:new mp.View({el:$('#cars-search-seller-type'),observers:{'car-attributes-fetched':function(data){var buyFrom=this.$el.data('buy-from');this.$el.empty();_.each(data.Adverteerder.items,_.bind(function(item){var $wrapDiv;$wrapDiv=$('<div class="sellertype-'+item.name+'">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id,'checked':function(){return buyFrom==='dealer'&&item.id==='S,10899';}}),$('<label>',{'for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),transmissieDropdown:new mp.Dropdown({el:$('#cars-search-transmission'),observers:{'car-attributes-fetched':function(data){data.Transmissie.items.unshift({name:'Geen voorkeur',id:''});this.render(data.Transmissie.items);this.enable();}}}),priceTypeRadioGroup:new mp.View({el:$('#cars-search-price-type'),observers:{'car-attributes-fetched':function(data){var checkVraagprijs=this.$el.data('check-vraagprijs');this.$el.empty();_.each(data.Prijstype.items,_.bind(function(item){var $wrapDiv;$wrapDiv=$('<div class="pricetype-'+item.name+'">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id,'checked':function(){return item.id==='S,10882'&&checkVraagprijs===true;}}),$('<label>',{'for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),carrosserieCheckboxes:new mp.View({el:$('#cars-search-carrosserie'),observers:{'car-attributes-fetched':function(data){this.$el.empty();var bodyTypes=data.Carrosserie;if(bodyTypes){this.$el.append('<span class="form-label unit">Carrosserie</span>');_.each(bodyTypes.items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}}),colorCheckboxes:new mp.View({el:$('#cars-search-color'),observers:{'car-attributes-fetched':function(data){this.$el.empty();_.each(data.Kleur.items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),engineCapacityCheckboxes:new mp.View({el:$('#cars-engine-capacity'),observers:{'car-attributes-fetched':function(data){this.$el.empty();var engineCapacities=data.Motorinhoud;if(engineCapacities){this.$el.append('<span class="form-label unit">Motorinhoud</span>');_.each(engineCapacities.items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}}),apkCheckboxes:new mp.View({el:$('#apk-search-options'),observers:{'car-attributes-fetched':function(data){this.$el.empty();_.each(data.APK.items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),numberOfSeatsCheckboxes:new mp.View({el:$('#number-of-seats-search-options'),observers:{'car-attributes-fetched':function(data){this.$el.empty();_.each(data['Aantal stoelen'].items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),numberOfDoorsCheckboxes:new mp.View({el:$('#number-of-doors-search-options'),observers:{'car-attributes-fetched':function(data){this.$el.empty();_.each(data['Aantal deuren'].items,_.bind(function(item){var $wrapDiv=$('<div class="input-list-item">').append($('<input>',{'type':'checkbox','id':item.id,'name':'attributes','value':item.id}),$('<label>',{'action':'my action','for':item.id,'html':item.name}));this.$el.append($wrapDiv);},this));}}}),distanceDropdown:new mp.Dropdown({el:$('#car-search-distances')}),mileageRangeView:{mileageRange:new mp.Range({form:searchForm,fields:[new mp.MileageInput({el:$('input[name="mileageFrom"]'),required:false,form:searchForm}),new mp.MileageInput({el:$('input[name="mileageTo"]'),required:false,form:searchForm})]})},queryInput:{mileageRange:new mp.Input({el:$('input[name="query"]')})}});searchForm.getChildView('modelsDropdown').render([{id:'',name:'Kies eerst een merk'}]).disable();},loadCarAttributes:function(){var id=$('#cars-search-categories').find('input').val();mp.PubSub.publish('car-attributes-loading');$.getJSON(mp.Urls.carModels.replace('{id}',id),function(data){data.items.unshift({name:'Alle modellen&hellip;',id:''});mp.PubSub.publish('car-models-fetched',[data.items]);});$.getJSON(mp.Urls.carAttributes.replace('{id}',id),function(data){mp.PubSub.publish('car-attributes-fetched',[data]);});}});AURORA.templates.cookieOptIn=unescape("%3Cdiv%20id%3D%22layover-target%22%3E%20%20%20%20%3Cdiv%20id%3D%22cookie-opt-in-footer%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cookie-opt-out-close%27%20id%3D%27cookie-opt-in-button%27%3E%20%20%20%20%20%20%20%20%20%20%20%20Sluiten%3Cspan%20id%3D%27close-cookie-opt-out%27%3EX%3C/span%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Cp%3E%20%20%20%20%20%20%20%20%20%20%20%20Marktplaats%20gebruikt%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20href%3D%27%7B%7BcookieUrl%7D%7D%27%20target%3D%27_blank%27%20id%3D%27opt-in-link-a%27%3Ecookies%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20om%20de%20site%20goed%20te%20laten%20functioneren%20voor%20analysedoeleinden%20en%20om%20u%20van%20relevante%20advertenties%20te%20voorzien.%3Cbr%3EVoor%20meer%20informatie%20zie%20ons%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20href%3D%27%7B%7BprivacyUrl%7D%7D%27%20target%3D%27_blank%27%20id%3D%27opt-in-link-b%27%3Ecookiebeleid%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20.%20Blijft%20u%20onze%20site%20gebruiken%20dan%20gaat%20u%20akkoord%20met%20het%20plaatsen%20van%20cookies.%20%20%20%20%20%20%20%20%3C/p%3E%20%20%20%20%3C/div%3E%3C/div%3E");mp.PriceTypeSelection=mp.View.extend({options:{},_minBidPriceEl:null,_minBidPriceRadioEl:null,_priceInput:null,_submitButton:null,init:function(){this._minBidPriceEl=this.$el.find('input[name="price.minimumBidPrice"]');this._minBidPriceRadioEl=$("#minimum-bid-price");this._submitButton=$("#price-edit-save .button");if(this.options.form){this._priceInput=new mp.PriceInput({el:this.$('input[name="price.value"]:first'),required:true,form:this.options.form});this.appendChildView("priceInput",this._priceInput);this.appendChildView('minBidPrice',new mp.PriceInput({el:this._minBidPriceEl,required:false,form:this.options.form}));}else{this._priceInput=new mp.PriceInput({el:this.$('input[name="price.value"]:first'),required:true});this.appendChildView("priceInput",this._priceInput);this.appendChildView('minBidPrice',new mp.PriceInput({el:this._minBidPriceEl,required:false}));}
if(this._minBidPriceRadioEl.is(':checked')){this._minBidPriceEl.prop('disabled',false);}
this.addEventHandlers();},addEventHandlers:function(){this.$el.find('input[type="radio"]').click(_.bind(this._toggleMinimumBidPriceInput,this));this._priceInput.addMinimumPriceCheckHandler();this._minBidPriceEl.blur(_.bind(function(){this._priceInput.setMinPriceTreshold(this._minBidPriceEl.val());},this));if(this.options.isAjaxForm){mp.PubSub.subscribe("is-minbid-entry-correct",_.bind(this._minbidEntryHandler,this));}},getPriceInputValue:function(){var val=$(this._priceInput.el).val();if(!val){return"";}else{return val;}},setPriceInputValue:function(value){$(this._priceInput.el).val(value);},setMinBidState:function(){this._priceInput.setMinPriceTreshold(this._minBidPriceEl.val());},_minbidEntryHandler:function(isCorrect){this._submitButton.prop("disabled",!isCorrect);if(isCorrect){this._submitButton.removeClass("disabled");}else{this._submitButton.addClass("disabled");}},_toggleMinimumBidPriceInput:function(evt){var buttonClicked=$(evt.target).attr('id');if(this._minBidPriceEl.is(':disabled')&&buttonClicked==='minimum-bid-price'){this._minBidPriceEl.prop('disabled',false);}else if(buttonClicked!=='minimum-bid-price'){this._minBidPriceEl.prop('disabled',true);this._minBidPriceEl.val("");this._submitButton.removeClass("disabled");this._submitButton.prop("disabled",false);mp.PubSub.publish("minimum-pricetype:disabled");}},render:function(){}});mp.MicroTip=mp.Input.extend({options:_.defaults({el:$('input[name="microTipText"]'),pattern:/^[^.,@#*<>]*$/,counter:this.$('.character-number'),counterMax:18,messages:{invalid:"Het is niet toegestaan om de volgende tekens te gebruiken: &gt; &lt; . , / @ # *"},required:false},mp.Input.prototype.options),isInvalidText:false,init:function(){var microTipText=$('input[name="microTipText"]');if(microTipText.length===0){return;}
this.options.el=microTipText;this.el=microTipText[0];this.$el=microTipText;mp.Input.prototype.init.call(this);this.uber.setElement(this.options.el);this.checkForIllegalCharacters();if(this.options.form){this.options.form.$el.find("input").keypress(_.bind(function(e){if(e.which==13){if(this.isInvalidText){return false;}
else{return true;}}},this));}
microTipText.keyup(_.bind(this.checkForIllegalCharacters,this));},checkForIllegalCharacters:function(evt){var microTipText=$('input[name="microTipText"]');var tip=microTipText.val();if(tip.match('[.,/@#*<>]')){this.mark(false,"Het is niet toegestaan om de volgende tekens te gebruiken: &gt; &lt; . , / @ # *");this.isInvalidText=true;mp.PubSub.publish("microtip-illegal-string");}else{this.mark(true);this.isInvalidText=false;mp.PubSub.publish("microtip-correct-string");}},clearErrorMessages:function(){this.mark(true);}});AURORA.gptBanners={sizeMappings:{'lrptop':[[[750,200],[[728,90],[468,60]]],[[468,200],[[468,60],[320,240],[320,100],[320,50]]]],'lrpbot':[[[750,200],[[728,90],[468,60]]],[[468,200],[[468,60],[320,240],[320,100],[320,50]]],[[0,0],[[300,250],[320,240],[320,100],[320,50]]]],'rb':[[[985,200],[[760,100],[728,90]]],[[953,200],[728,90]],[[468,200],[[468,60],[320,240],[320,100],[320,50]]],[[0,0],[[300,250],[320,240],[320,100],[320,50]]]],'ss':[[[750,200],[[120,600],[160,600]]]],'avipmr':[[[985,244],[[300,600],[300,250],[320,240],[320,100],[320,50]]],[[300,250],[[300,250],[320,240],[320,100],[320,50]]]],'vipt1':[[[568,200],[225,40]]],'vipt2':[[[568,200],[225,40]]],'tab1':[[[768,200],[300,100]]],'tab2':[[[768,200],[300,101]]],'map':[[[748,200],[728,90]]],'img':[[[748,200],[728,90]]],'soi':[[[985,255],[[980,250],[980,200],[760,100],[728,90]]],[[750,200],[[728,90],[468,60]]],[[468,200],[[468,60],[320,240],[320,100],[320,50]]],[[0,0],[320,50]]],'verkopers':[[[750,200],[[728,90],[468,60]]],[[468,200],[[468,60],[320,240],[320,100],[320,50]]]]},fallbackSizes:{'lrptop':[728,90],'lrpbot':[728,90],'rb':[760,100],'ss':[120,600],'avipmr':[300,600],'vipt1':[225,40],'vipt2':[225,40],'tab1':[300,101],'tab2':[300,101],'map':[728,90],'img':[728,90],'soi':[728,90],'verkopers':[728,90]},loadBanners:function(bannerData,enableSingleRequest,gptTest,publisherProvidedId,responsiveEnabled){mp.PubSub.subscribe('gpt-no-banner',function(obj){var acc=document.getElementsByName(obj.iFrameName),adIframe=$(acc);adIframe.parent().parent().hide();});googletag.cmd.push(_.bind(function(){googletag.pubads().addEventListener('slotRenderEnded',function(event){if(event.size[0]>900&&event.slot.b.d==='banner-top'){var bannerHeight=event.size[1];var scrolledHeight=$(window).scrollTop();if(scrolledHeight>0){var vHeight=scrolledHeight+parseInt(bannerHeight,10);$(window).scrollTop(vHeight);}}});_.each(bannerData,_.bind(function(data,index){var slot;if(responsiveEnabled===true){var position=data.bannerParameters.pos,mapping=this.sizeMappings[position],fallbackSize=this.fallbackSizes[position],addSlot=true;if(window.matchMedia&&window.matchMedia('(max-width: 750px)').matches&&position==='ss'){addSlot=false;bannerData[index].delete=true;}
if(window.matchMedia&&window.matchMedia('(max-width: 468px)').matches&&position==='verkopers'){addSlot=false;bannerData[index].delete=true;}
if(window.matchMedia&&window.matchMedia('(max-width: 468px)').matches&&position==='lrptop'){addSlot=false;$('#banner-top').hide();bannerData[index].delete=true;}
if(window.matchMedia&&window.matchMedia('(max-width: 568px)').matches&&(position==='vipt1'||position==='vipt2')){addSlot=false;$('#action-block-banners').hide();bannerData[index].delete=true;}
if(window.matchMedia&&window.matchMedia('(max-width: 768px)').matches&&(position==='tab1'||position==='tab2')){addSlot=false;$('.premium-content').hide();bannerData[index].delete=true;}
if(window.matchMedia&&window.matchMedia('(max-width: 768px)').matches&&(position==='map'||position==='img')){addSlot=false;$('#vip-map-banner, #vip-image-popup-banner').hide();bannerData[index].delete=true;}
if(addSlot){if(position==='tab1'||position==='tab2'){slot=googletag.defineSlot(data.adUnit,data.sizes,data.target).addService(googletag.pubads());}else{slot=googletag.defineSlot(data.adUnit,fallbackSize,data.target).defineSizeMapping(mapping).addService(googletag.pubads());}
for(var param in data.bannerParameters){if(data.bannerParameters.hasOwnProperty(param)){slot.setTargeting(param,data.bannerParameters[param]);}}}}else{slot=googletag.defineSlot(data.adUnit,data.sizes,data.target).addService(googletag.pubads());for(var key in data.bannerParameters){slot.setTargeting(key,data.bannerParameters[key]);}}},this));googletag.pubads().setTargeting('test',gptTest);if(enableSingleRequest){googletag.pubads().enableSingleRequest();}
if(publisherProvidedId){googletag.pubads().setPublisherProvidedId(publisherProvidedId);}
googletag.pubads().collapseEmptyDivs();googletag.enableServices();_.each(bannerData,function(data){if(data.delete!==true){googletag.display(data.target);}});},this));}};AURORA.nameSpace.create('AURORA.BubbleHelp');AURORA.BubbleHelp=mp.View.extend({options:{targetClasses:[],bubbleTimeout:3000,bubbleContentDataAttributeName:'tooltip',templates:{}},init:function(){this._bindTargets(this.options.targetClasses);this._createBubbleElOnce();},addTargetClasses:function(classNames){this._bindTargets(classNames);_.each(classNames,_.bind(function(className){this.options.targetClasses.push(className);},this));},rebindAllTargetClasses:function(){this._unbindTargets(this.options.targetClasses);this._bindTargets(this.options.targetClasses);},_bindTargets:function(targetClasses){_.each(targetClasses,function(className){var target=$("."+className);target.bind('mouseenter',_.bind(function(evt){this._showBubble(evt);},this));$("."+className+" *").bind('mouseenter',_.bind(function(evt){this._showBubble(evt);},this));target.bind('mouseleave',_.bind(function(){this._hideBubble();},this));_.each(target,function(elem){$(elem).bind('mousemove',{customTimeout:$(elem).data('bubble-timeout')},_.bind(function(evt){this._restartHideTimeout(evt);},this));},this);},this);},_unbindTargets:function(targetClasses){_.each(targetClasses,function(className){$("."+className).unbind();});},_showBubble:function(evt){var tagIsChild=true,target=$(evt.target);_.each(this.options.targetClasses,function(className){if(target.hasClass(className)){tagIsChild=false;}});if(tagIsChild){var depth=0;while(target.data(this.options.bubbleContentDataAttributeName)===undefined&&depth!==3){target=target.parent();depth++;}}
var bubbleContent=target.data(this.options.bubbleContentDataAttributeName),model={"content":bubbleContent},useNamedTemplate=target.data('bubble-template')||false;if(_.isString(bubbleContent)){if(bubbleContent.length===0)return;}
if(bubbleContent===undefined)return;this.render(model,useNamedTemplate);this.$el.css(this._bubbleCssPosition(evt,target));this.$el.show();this._restartHideTimeout(target);},_hideBubble:function(){this.$el.hide();},_bubbleCssPosition:function(evt,target){var pageX=evt.pageX,targetTop=target.offset().top,theScrollTop=$(window).scrollTop(),bubbleHeight=this.$el.height(),cssObj={'top':targetTop-30-theScrollTop-bubbleHeight,'left':pageX-10};return cssObj;},_restartHideTimeout:function(evt){var timeOut;if(evt.data.customTimeout!==undefined){timeOut=evt.data.customTimeout;}else{timeOut=this.options.bubbleTimeout;}
clearTimeout(this.timeOut);this.timeOut=setTimeout(_.bind(function(){this._hideBubble();},this),timeOut);},_template:'<div id="bubble-help" class="bubble-help info" style="display:none"></div>',_createBubbleElOnce:function(){if($('#bubble-help').length===0){$(document.body).append($(this._template));this.setElement($('#bubble-help'));}},render:function(model,useNamedTemplate){if(!useNamedTemplate){this.$el.html(model.content);}else{this.$el.html(Mustache.render(this.options.templates[useNamedTemplate],model.content));}}});AURORA.ie9CorsRequest=(function(){var Constr,cookieExchangeUrl,baseUrl,token,userId,requestCallbacks={success:function(){},error:function(){}},createIframe=function(){if($('#oProxy').length===0){var html='<div style="display:block"><iframe id="oProxy" width="300px" height="100px" src="https://'+baseUrl+'/aurora/res/static/iecors.htm"></iframe></div>';$('body').append(html);}},listen=function(){if(document.addEventListener){window.addEventListener("message",function(e){requestCallbacks.success(JSON.parse(e.data));},false);}},trySend=function(obj){try{var msg={'cookieExchangeUrl':cookieExchangeUrl,'apiUrl':obj.url,'token':token,'payload':obj.body,'userId':userId};requestCallbacks.success=obj.success;requestCallbacks.error=obj.error;oProxy.postMessage(JSON.stringify(msg),"*");}
catch(e){obj.error("Message Failed. Proxy is not at"+obj.url);}};Constr=function(config){this.initialise(config);};Constr.prototype={constructor:AURORA.ie9CorsRequest,initialise:function(config){cookieExchangeUrl=config.cookieExchangeUrl;token=config.token;userId=config.token;baseUrl=config.baseUrl;createIframe();listen();},send:trySend};return Constr;})();